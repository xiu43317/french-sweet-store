import{_ as U,M as S,o as h,c as b,a as e,w as _,h as $,v as C,Z as P,r as u,d as E,i as M,f as g,F as N,l as I,Y as y,t as w}from"./index-invxNhHQ.js";import{D as T}from"./DeleteModal-0hjLpIvT.js";import{A as B}from"./BottomPagination-51KYOAk7.js";const F={data(){return{couponModal:"",tempCoupon:{},due_date:"",is_newCoupon:!1}},props:["coupon","isNew"],methods:{openModal(){this.couponModal.show()},closeModal(){this.couponModal.hide()},updateCoupon(){this.$emit("update",this.tempCoupon)}},mounted(){this.couponModal=new S(this.$refs.modal,{keyboard:!1})},watch:{coupon(){this.tempCoupon={...this.coupon},this.tempCoupon.due_date=this.tempCoupon.due_date*1e3;const v=new Date(this.tempCoupon.due_date).toISOString().split("T");this.due_date=v[0]},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date))},isNew(){this.is_newCoupon=this.isNew}}},O={id:"couponModal",ref:"modal",class:"modal fade",tabindex:"1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},Y={class:"modal-dialog",role:"document"},Z={class:"modal-content"},j={class:"modal-header bg-secondary"},q={class:"modal-title text-white"},z=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},H={class:"mb-3"},J=e("label",{for:"title"},"標題",-1),K={class:"mb-3"},Q=e("label",{for:"coupon_code"},"優惠碼",-1),R={class:"mb-3"},W=e("label",{for:"due_date"},"到期日",-1),X={class:"mb-3"},ee=e("label",{for:"price"},"折扣百分比",-1),oe={class:"mb-3"},te={class:"form-check"},ne=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),se={class:"modal-footer"},le=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function ae(v,o,m,t,s,c){return h(),b("div",O,[e("div",Y,[e("div",Z,[e("div",j,[e("h5",q,[_(e("span",null,"新增優惠券",512),[[$,m.isNew]]),_(e("span",null,"更新優惠券",512),[[$,!m.isNew]])]),z]),e("div",G,[e("div",H,[J,_(e("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=n=>s.tempCoupon.title=n)},null,512),[[C,s.tempCoupon.title]])]),e("div",K,[Q,_(e("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[1]||(o[1]=n=>s.tempCoupon.code=n)},null,512),[[C,s.tempCoupon.code]])]),e("div",R,[W,_(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=n=>s.due_date=n)},null,512),[[C,s.due_date]])]),e("div",X,[ee,_(e("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入折扣百分比","onUpdate:modelValue":o[3]||(o[3]=n=>s.tempCoupon.percent=n)},null,512),[[C,s.tempCoupon.percent,void 0,{number:!0}]])]),e("div",oe,[e("div",te,[_(e("input",{type:"checkbox",class:"form-check-input","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=n=>s.tempCoupon.is_enabled=n)},null,512),[[P,s.tempCoupon.is_enabled]]),ne])])]),e("div",se,[le,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=n=>c.updateCoupon())},"更新優惠券")])])])],512)}const de=U(F,[["render",ae]]),k="https://vue3-course-api.hexschool.io/v2",x="rock",ie={components:{CouponModal:de,AdminPagination:B,DeleteModal:T},setup(v){const o=u([]),m=u({}),t=u({}),s=u(!1),c=u(!1),n=u(null),p=u(null),f=u({title:"",is_enabled:0,code:"",due_date:new Date/1e3,percent:"",id:""}),D=(l,a={})=>{l==="new"?(c.value=!0,t.value={...f.value},n.value.openModal()):l==="delete"?(c.value=!1,t.value=a,p.value.openModal()):l==="edit"&&(c.value=!1,t.value={...a},n.value.openModal())},d=()=>{n.value.closeModal(),p.value.hideModal()},r=(l=1)=>{s.value=!0,y.get(`${k}/api/${x}/admin/coupons?page=${l}`).then(a=>{o.value=[...a.data.coupons],m.value={...a.data.pagination},o.value.forEach(i=>{const L=new Date(i.due_date*1e3).toISOString().split("T")[0];i.formatDate=L}),s.value=!1}).catch(a=>{alert(a.message),s.value=!1})},V=l=>{y.delete(`${k}/api/${x}/admin/coupon/${l}`).then(a=>{alert(a.data.message),p.value.hideModal(),r()}).catch(a=>{alert(a.message),p.value.hideModal()})},A=l=>{const a={title:l.title,is_enabled:l.is_enabled,percent:l.percent,due_date:l.due_date/1e3,code:l.code};c.value?y.post(`${k}/api/${x}/admin/coupon`,{data:a}).then(i=>{alert(i.data.message),d(),r()}).catch(i=>{console.log(i),alert(i.response.data.message)}):y.put(`${k}/api/${x}/admin/coupon/${l.id}`,{data:a}).then(i=>{alert(i.data.message),d(),r()}).catch(i=>{alert(i.response.data.message)})};return E(()=>{r()}),{coupons:o,pages:m,tempCoupon:t,isLoading:s,isNew:c,emptyCoupon:f,openModal:D,couponModal:n,delCouponModal:p,closeModal:d,getCoupons:r,deleteCoupon:V,updateCoupon:A}}},ce=e("div",{class:"h3 mt-4 text-center"},"優惠卷新增頁面",-1),ue={class:"container"},pe={class:"text-end mt-4"},re={class:"table mt-4"},_e=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"折扣碼"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),me={key:0,class:"text-success"},he={key:1},be={class:"btn-group"},ve=["onClick"],fe=["onClick"];function Ce(v,o,m,t,s,c){const n=M("myLoading"),p=M("CouponModal"),f=M("DeleteModal"),D=M("AdminPagination");return h(),b(N,null,[g(n,{active:t.isLoading},null,8,["active"]),ce,e("div",ue,[e("div",pe,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=d=>t.openModal("new"))}," 建立新的優惠卷 "),g(p,{ref:"couponModal",onUpdate:t.updateCoupon,isNew:t.isNew,coupon:t.tempCoupon},null,8,["onUpdate","isNew","coupon"])]),e("table",re,[_e,e("tbody",null,[(h(!0),b(N,null,I(t.coupons,d=>(h(),b("tr",{key:d.id},[e("td",null,w(d.title),1),e("td",null,w(d.percent),1),e("td",null,w(d.formatDate),1),e("td",null,w(d.code),1),e("td",null,[d.is_enabled?(h(),b("span",me,"啟用")):(h(),b("span",he,"未啟用"))]),e("td",null,[e("div",be,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:r=>t.openModal("edit",d)}," 編輯 ",8,ve),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>t.openModal("delete",d)}," 刪除 ",8,fe)])])]))),128))])]),g(f,{product:t.tempCoupon,onDeleteItem:t.deleteCoupon,ref:"delCouponModal"},null,8,["product","onDeleteItem"]),g(D,{pages:t.pages,onEmitPage:t.getCoupons,ref:"pagination"},null,8,["pages","onEmitPage"])])],64)}const we=U(ie,[["render",Ce]]);export{we as default};
