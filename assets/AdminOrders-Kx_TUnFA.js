import{_ as O,M as v,o as d,c as n,a as e,t as o,k as y,F as _,l as M,w as g,Z as k,i as p,f as m,h as $}from"./index-luTI91mF.js";import{D as L}from"./DeleteModal-CHa7yDC9.js";const w={data(){return{tempOrder:{user:{}},orderModal:""}},props:["selectedOrder"],methods:{date(t){return new Date(t*1e3).toLocaleDateString()},currency(t){return`${parseInt(t,10).toFixed(0).replace(/./g,(c,u,s)=>u&&c!=="."&&(s.length-u)%3===0?`, ${c}`.replace(/\s/g,""):c)}`},openModal(){this.tempOrder={...this.selectedOrder},this.orderModal.show()},closeModal(){this.orderModal.hide()}},watch:{selectedOrder(){this.tempOrder={...this.selectedOrder}}},mounted(){this.orderModal=new v(this.$refs.modal)}},A={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl",role:"document"},V={class:"modal-content border-0"},P=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),U={class:"modal-body"},F={class:"row"},I={class:"col-md-4"},B=e("h3",null,"用戶資料",-1),E={class:"table"},N={key:0},q=e("th",{style:{width:"100px"}},"姓名",-1),j=e("th",null,"Email",-1),Z=e("th",null,"電話",-1),z=e("th",null,"地址",-1),G={class:"col-md-8"},H=e("h3",null,"訂單細節",-1),J={class:"table"},K=e("th",{style:{width:"100px"}},"訂單編號",-1),Q=e("th",null,"下單時間",-1),R=e("th",null,"付款時間",-1),T={key:0},W={key:1},X=e("th",null,"付款狀態",-1),Y={key:0,class:"text-success"},ee={key:1,class:"text-muted"},te=e("th",null,"總金額",-1),se=e("h3",null,"選購商品",-1),le={class:"table"},oe=e("thead",null,[e("tr")],-1),de={class:"text-end"},ne={class:"d-flex justify-content-end"},ae={class:"form-check"},re={class:"form-check-label",for:"flexCheckDefault"},ie={key:0},ce={key:1},he={class:"modal-footer"},ue=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function _e(t,l,c,u,s,r){return d(),n("div",A,[e("div",S,[e("div",V,[P,e("div",U,[e("div",F,[e("div",I,[B,e("table",E,[s.tempOrder.user?(d(),n("tbody",N,[e("tr",null,[q,e("td",null,o(s.tempOrder.user.name),1)]),e("tr",null,[j,e("td",null,o(s.tempOrder.user.email),1)]),e("tr",null,[Z,e("td",null,o(s.tempOrder.user.tel),1)]),e("tr",null,[z,e("td",null,o(s.tempOrder.user.address),1)])])):y("",!0)])]),e("div",G,[H,e("table",J,[e("tbody",null,[e("tr",null,[K,e("td",null,o(s.tempOrder.id),1)]),e("tr",null,[Q,e("td",null,o(r.date(s.tempOrder.create_at)),1)]),e("tr",null,[R,e("td",null,[s.tempOrder.paid_date?(d(),n("span",T,o(r.date(s.tempOrder.paid_date)),1)):(d(),n("span",W,"時間不正確"))])]),e("tr",null,[X,e("td",null,[s.tempOrder.is_paid?(d(),n("strong",Y,"已付款")):(d(),n("span",ee,"尚未付款"))])]),e("tr",null,[te,e("td",null,o(r.currency(s.tempOrder.total)),1)])])]),se,e("table",le,[oe,e("tbody",null,[(d(!0),n(_,null,M(s.tempOrder.products,i=>(d(),n("tr",{key:i.id},[e("th",null,o(i.product.title),1),e("td",null,o(i.qty)+" / "+o(i.product.unit),1),e("td",de,o(r.currency(i.final_total)),1)]))),128))])]),e("div",ne,[e("div",ae,[g(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":l[0]||(l[0]=i=>s.tempOrder.is_paid=i)},null,512),[[k,s.tempOrder.is_paid]]),e("label",re,[s.tempOrder.is_paid?(d(),n("span",ie,"已付款")):(d(),n("span",ce,"未付款"))])])])])])]),e("div",he,[ue,e("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=i=>t.$emit("update-paid",s.tempOrder))}," 修改付款狀態 ")])])])],512)}const pe=O(w,[["render",_e]]),me={data(){return{myModal:""}},methods:{openModal(){this.myModal.show()},closeModal(){this.myModal.hide()}},mounted(){this.myModal=new v(this.$refs.modal)}},be={class:"modal fade",id:"delAllModal","aria-hidden":"true",tabindex:"-1",ref:"modal"},fe={class:"modal-dialog"},ge={class:"modal-content"},ye=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-light"},"清空訂單"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Me=e("div",{class:"modal-body"},[e("p",null,"確定清空所有訂單？")],-1),Oe={class:"modal-footer"},$e=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ve(t,l,c,u,s,r){return d(),n("div",be,[e("div",fe,[e("div",ge,[ye,Me,e("div",Oe,[$e,e("button",{type:"button",class:"btn btn-danger",onClick:l[0]||(l[0]=i=>this.$emit("clear-all"))},"確定刪除")])])])],512)}const ke=O(me,[["render",ve]]),b="https://vue3-course-api.hexschool.io/v2",f="rock",xe={data(){return{orders:[],isLoading:!1,tempOrder:{}}},methods:{getOrders(){this.isLoading=!0,this.$http.get(`${b}/api/${f}/admin/orders`).then(t=>{this.orders=[...t.data.orders],this.isLoading=!1}).catch(t=>{console.log(t.response.data.message),this.isLoading=!1})},date(t){return new Date(t*1e3).toLocaleDateString()},currency(t){return`${parseInt(t,10).toFixed(0).replace(/./g,(c,u,s)=>u&&c!=="."&&(s.length-u)%3===0?`, ${c}`.replace(/\s/g,""):c)}`},openDelOrderModal(t){this.tempOrder=t,this.$refs.deleteModal.openModal()},updatePaid(t){this.$http.put(`${b}/api/${f}/admin/order/${t.id}`,{data:t}).then(l=>{alert(l.data.message),this.$refs.orderModal.closeModal(),this.getOrders()}).catch(l=>{console.log(l),alert(l.response.data.message),this.$refs.orderModal.closeModal()})},deleteOrder(t){this.isLoading=!0,this.$http.delete(`${b}/api/${f}/admin/order/${t}`).then(l=>{this.isLoading=!1,alert(l.data.message+"該訂單"),this.$refs.deleteModal.hideModal(),this.getOrders()}).catch(l=>{this.isLoading=!1,alert(l.response.data.message),this.$refs.deleteModal.hideModal()})},openModal(t){this.tempOrder=t,this.$refs.orderModal.openModal()},deleteAllOrders(){this.isLoading=!0,this.$http.delete(`${b}/api/${f}/admin/orders/all`).then(t=>{alert(t.data.message),this.isLoading=!1,this.getOrders()}).catch(t=>{alert(t.response.data.message),this.isLoading=!1})}},mounted(){this.getOrders()},components:{DeleteModal:L,OrderModal:pe,DeleteAllModal:ke}},De=e("div",{class:"h3 text-center mt-4"},"訂單列表",-1),Ce={class:"container"},Le={class:"text-end"},we={class:"table mt-4"},Ae=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Se={key:0},Ve=["textContent"],Pe={class:"list-unstyled"},Ue={class:"text-right"},Fe={class:"form-check form-switch"},Ie=["id","onUpdate:modelValue","onChange"],Be=["for"],Ee={class:"btn-group"},Ne=["onClick"],qe=["onClick"];function je(t,l,c,u,s,r){const i=p("myLoading"),x=p("DeleteModal"),D=p("OrderModal"),C=p("DeleteAllModal");return d(),n(_,null,[m(i,{active:s.isLoading},null,8,["active"]),De,e("div",Ce,[e("div",Le,[e("button",{type:"button",class:"btn btn-danger mt-3",onClick:l[0]||(l[0]=a=>this.$refs.deleteAllModal.openModal())},"刪除全部訂單")]),e("table",we,[Ae,e("tbody",null,[(d(!0),n(_,null,M(s.orders,a=>(d(),n(_,{key:a.id},[s.orders.length?(d(),n("tr",Se,[e("td",null,o(r.date(a.create_at)),1),e("td",null,[a.user?(d(),n("span",{key:0,textContent:o(a.user.email)},null,8,Ve)):y("",!0)]),e("td",null,[e("ul",Pe,[(d(!0),n(_,null,M(a.products,h=>(d(),n("li",{key:h.id},o(h.product.title)+" 數量："+o(h.qty)+" "+o(h.product.unit),1))),128))])]),e("td",Ue,o(r.currency(a.total)),1),e("td",null,[e("div",Fe,[g(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":h=>a.is_paid=h,onChange:h=>r.updatePaid(a)},null,40,Ie),[[k,a.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[g(e("span",null,"已付款",512),[[$,a.is_paid]]),g(e("span",null,"未付款",512),[[$,!a.is_paid]])],8,Be)])]),e("td",null,[e("div",Ee,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:h=>r.openModal(a)}," 檢視 ",8,Ne),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:h=>r.openDelOrderModal(a)}," 刪除 ",8,qe)])])])):y("",!0)],64))),128))])])]),m(x,{product:s.tempOrder,onDeleteItem:r.deleteOrder,ref:"deleteModal"},null,8,["product","onDeleteItem"]),m(D,{selectedOrder:s.tempOrder,onUpdatePaid:r.updatePaid,ref:"orderModal"},null,8,["selectedOrder","onUpdatePaid"]),m(C,{ref:"deleteAllModal",onClearAll:r.deleteAllOrders},null,8,["onClearAll"])],64)}const Ge=O(xe,[["render",je]]);export{Ge as default};
