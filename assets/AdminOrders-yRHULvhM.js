import{_ as P,r as p,y as j,d as L,M as E,o as r,c,a as e,t as a,k as w,F as O,l as A,w as $,Z as U,i as f,f as M,Y as k,h as V}from"./index-RO-PkHRX.js";import{D as Y}from"./DeleteModal-hb0xCSkF.js";import{A as Z}from"./BottomPagination-zRX_HBun.js";const z={props:["selectedOrder"],setup(m){const n=p(null),s=p({user:{}});let t;const u=_=>new Date(_*1e3).toLocaleDateString(),v=_=>`${parseInt(_,10).toFixed(0).replace(/./g,(g,l,i)=>l&&g!=="."&&(i.length-l)%3===0?`, ${g}`.replace(/\s/g,""):g)}`,d=()=>{s.value={...m.selectedOrder},t.show()},b=()=>{t.hide()};return j(()=>m.selectedOrder,()=>{s.value={...m.selectedOrder}}),L(()=>{t=new E(n.value)}),{tempOrder:s,date:u,currency:v,openModal:d,orderModal:t,closeModal:b,modal:n}}},G={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},H={class:"modal-dialog modal-xl",role:"document"},J={class:"modal-content border-0"},K=e("div",{class:"modal-header bg-secondary text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Q={class:"modal-body"},R={class:"row"},T={class:"col-md-4"},W=e("h3",null,"用戶資料",-1),X={class:"table"},ee={key:0},te=e("th",{style:{width:"100px"}},"姓名",-1),le=e("th",null,"Email",-1),oe=e("th",null,"電話",-1),ne=e("th",null,"地址",-1),se=e("th",null,"備註",-1),ae={class:"col-md-8"},de=e("h3",null,"訂單細節",-1),re={class:"table"},ce=e("th",{style:{width:"100px"}},"訂單編號",-1),ie=e("th",null,"下單時間",-1),ue=e("th",null,"付款時間",-1),_e={key:0},he={key:1},pe=e("th",null,"付款狀態",-1),me={key:0,class:"text-success"},be={key:1,class:"text-muted"},ve=e("th",null,"總金額",-1),ge=e("h3",null,"選購商品",-1),ye={class:"table"},fe=e("thead",null,[e("tr")],-1),Me={class:"text-end"},Oe={class:"d-flex justify-content-end"},ke={class:"form-check"},xe={class:"form-check-label",for:"flexCheckDefault"},De={key:0},$e={key:1},Ce={class:"modal-footer"},we=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ae(m,n,s,t,u,v){return r(),c("div",G,[e("div",H,[e("div",J,[K,e("div",Q,[e("div",R,[e("div",T,[W,e("table",X,[t.tempOrder.user?(r(),c("tbody",ee,[e("tr",null,[te,e("td",null,a(t.tempOrder.user.name),1)]),e("tr",null,[le,e("td",null,a(t.tempOrder.user.email),1)]),e("tr",null,[oe,e("td",null,a(t.tempOrder.user.tel),1)]),e("tr",null,[ne,e("td",null,a(t.tempOrder.user.address),1)]),e("tr",null,[se,e("td",null,a(t.tempOrder.message),1)])])):w("",!0)])]),e("div",ae,[de,e("table",re,[e("tbody",null,[e("tr",null,[ce,e("td",null,a(t.tempOrder.id),1)]),e("tr",null,[ie,e("td",null,a(t.date(t.tempOrder.create_at)),1)]),e("tr",null,[ue,e("td",null,[t.tempOrder.paid_date?(r(),c("span",_e,a(t.date(t.tempOrder.paid_date)),1)):(r(),c("span",he,"時間不正確"))])]),e("tr",null,[pe,e("td",null,[t.tempOrder.is_paid?(r(),c("strong",me,"已付款")):(r(),c("span",be,"尚未付款"))])]),e("tr",null,[ve,e("td",null,a(t.currency(t.tempOrder.total)),1)])])]),ge,e("table",ye,[fe,e("tbody",null,[(r(!0),c(O,null,A(t.tempOrder.products,d=>(r(),c("tr",{key:d.id},[e("th",null,a(d.product.title),1),e("td",null,a(d.qty)+" / "+a(d.product.unit),1),e("td",Me,a(t.currency(d.final_total)),1)]))),128))])]),e("div",Oe,[e("div",ke,[$(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=d=>t.tempOrder.is_paid=d)},null,512),[[U,t.tempOrder.is_paid]]),e("label",xe,[t.tempOrder.is_paid?(r(),c("span",De,"已付款")):(r(),c("span",$e,"未付款"))])])])])])]),e("div",Ce,[we,e("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=d=>m.$emit("update-paid",t.tempOrder))}," 修改付款狀態 ")])])])],512)}const Pe=P(z,[["render",Ae]]),Le={setup(m){let n;const s=p(null),t=()=>{n.show()},u=()=>{n.hide()};return L(()=>{n=new E(s.value)}),{modal:s,openModal:t,closeModal:u}}},Se={class:"modal fade",id:"delAllModal","aria-hidden":"true",tabindex:"-1",ref:"modal"},Ve={class:"modal-dialog"},Ee={class:"modal-content"},Ue=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-light"},"清空訂單"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Fe=e("div",{class:"modal-body"},[e("p",null,"確定清空所有訂單？")],-1),Ie={class:"modal-footer"},Be=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ne(m,n,s,t,u,v){return r(),c("div",Se,[e("div",Ve,[e("div",Ee,[Ue,Fe,e("div",Ie,[Be,e("button",{type:"button",class:"btn btn-danger",onClick:n[0]||(n[0]=d=>this.$emit("clear-all"))},"確定刪除")])])])],512)}const qe=P(Le,[["render",Ne]]),x="https://vue3-course-api.hexschool.io/v2",D="rock",je={components:{DeleteModal:Y,OrderModal:Pe,DeleteAllModal:qe,AdminPagination:Z},setup(m){const n=p([]),s=p(!1),t=p({}),u=p(null),v=p({}),d=p(null),b=p(null),_=()=>{s.value=!0,k.get(`${x}/api/${D}/admin/orders`).then(o=>{n.value=[...o.data.orders],v.value={...o.data.pagination},s.value=!1}).catch(o=>{console.log(o.response.data.message),s.value=!1})},y=o=>new Date(o*1e3).toLocaleDateString(),g=o=>`${parseInt(o,10).toFixed(0).replace(/./g,(C,S,q)=>S&&C!=="."&&(q.length-S)%3===0?`, ${C}`.replace(/\s/g,""):C)}`,l=o=>{t.value=o,d.value.openModal()},i=o=>{k.put(`${x}/api/${D}/admin/order/${o.id}`,{data:o}).then(h=>{alert(h.data.message),b.value.closeModal(),_()}).catch(h=>{console.log(h),alert(h.response.data.message),b.value.closeModal()})},F=o=>{s.value=!0,k.delete(`${x}/api/${D}/admin/order/${o}`).then(h=>{s.value=!1,alert(h.data.message+"該訂單"),d.value.hideModal(),_()}).catch(h=>{s.value=!1,alert(h.response.data.message),d.value.hideModal()})},I=o=>{t.value=o,b.value.openModal()},B=()=>{s.value=!0,k.delete(`${x}/api/${D}/admin/orders/all`).then(o=>{alert(o.data.message),s.value=!1,u.value.closeModal(),_()}).catch(o=>{alert(o.response.data.message),s.value=!1,u.value.closeModal()})},N=()=>{u.value.openModal()};return L(()=>{_()}),{orders:n,isLoading:s,tempOrder:t,pages:v,getOrders:_,date:y,currency:g,openDelOrderModal:l,updatePaid:i,deleteOrder:F,openModal:I,deleteAllOrders:B,orderModal:b,deleteModal:d,deleteAllModal:u,openDelAllModal:N}}},Ye=e("div",{class:"h3 text-center mt-4"},"訂單列表",-1),Ze={class:"container"},ze={class:"text-end"},Ge={class:"table mt-4"},He=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Je={key:0},Ke=["textContent"],Qe={class:"list-unstyled"},Re={class:"text-right"},Te={class:"form-check form-switch"},We=["id","onUpdate:modelValue","onChange"],Xe=["for"],et={class:"btn-group"},tt=["onClick"],lt=["onClick"];function ot(m,n,s,t,u,v){const d=f("myLoading"),b=f("AdminPagination"),_=f("DeleteModal"),y=f("OrderModal"),g=f("DeleteAllModal");return r(),c(O,null,[M(d,{active:t.isLoading},null,8,["active"]),Ye,e("div",Ze,[e("div",ze,[e("button",{type:"button",class:"btn btn-danger mt-3",onClick:n[0]||(n[0]=l=>t.openDelAllModal())},"刪除全部訂單")]),e("table",Ge,[He,e("tbody",null,[(r(!0),c(O,null,A(t.orders,l=>(r(),c(O,{key:l.id},[t.orders.length?(r(),c("tr",Je,[e("td",null,a(t.date(l.create_at)),1),e("td",null,[l.user?(r(),c("span",{key:0,textContent:a(l.user.email)},null,8,Ke)):w("",!0)]),e("td",null,[e("ul",Qe,[(r(!0),c(O,null,A(l.products,i=>(r(),c("li",{key:i.id},a(i.product.title)+" 數量："+a(i.qty)+" "+a(i.product.unit),1))),128))])]),e("td",Re,a(t.currency(l.total)),1),e("td",null,[e("div",Te,[$(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${l.id}`,"onUpdate:modelValue":i=>l.is_paid=i,onChange:i=>t.updatePaid(l)},null,40,We),[[U,l.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${l.id}`},[$(e("span",null,"已付款",512),[[V,l.is_paid]]),$(e("span",null,"未付款",512),[[V,!l.is_paid]])],8,Xe)])]),e("td",null,[e("div",et,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:i=>t.openModal(l)}," 檢視 ",8,tt),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:i=>t.openDelOrderModal(l)}," 刪除 ",8,lt)])])])):w("",!0)],64))),128))])]),M(b,{pages:t.pages,onEmitPage:t.getOrders,ref:"pagination"},null,8,["pages","onEmitPage"])]),M(_,{product:t.tempOrder,onDeleteItem:t.deleteOrder,ref:"deleteModal"},null,8,["product","onDeleteItem"]),M(y,{selectedOrder:t.tempOrder,onUpdatePaid:t.updatePaid,ref:"orderModal"},null,8,["selectedOrder","onUpdatePaid"]),M(g,{ref:"deleteAllModal",onClearAll:t.deleteAllOrders},null,8,["onClearAll"])],64)}const dt=P(je,[["render",ot]]);export{dt as default};
