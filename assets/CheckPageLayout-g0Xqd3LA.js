import{_ as U,s as E,r as y,d as j,y as H,i as v,o as b,c as x,a as t,t as S,w as I,v as M,h as D,f as r,F as P,p as G,b as J,u as K,g as Q,j as W,l as X,k as q,m as Y,A as L}from"./index-moY6mszh.js";import{F as Z}from"./FlowChart-FZ4B62us.js";import{u as z}from"./cart-ZGeNaZ3G.js";import{n as f,a as tt}from"./axios-3Z5XKonf.js";import{d as A}from"./math-9XHDQUjD.js";import{S as k}from"./sweetalert2.all-V0Gwh2pB.js";const et={props:["cart"],emits:["deleteOneItem"],setup(s,a){const l=z(),{getCart:e,updateCart:p,changeAddStatus:m}=l,{addBtnState:_}=E(l),o=y(s.cart.qty),T=y(!1),V=y(null);let c=0;const g=y(!1),C=()=>{a.emit("deleteOneItem",s.cart)},F=async()=>{m(!0),o.value+=1;const w={data:{product_id:s.cart.product_id,qty:o.value}};await p(s.cart.id,w).then(h=>{f(!0,`${s.cart.product.title}已加入`)}).catch(h=>{f(!1,`${h.response.data.message}`)}),await e(),m(!1)},n=async()=>{m(!0);const w={data:{product_id:s.cart.product_id,qty:o.value}};await p(s.cart.id,w).then(()=>{f(!0,`${s.cart.product.title}已更新`)}).catch(h=>{f(!1,`${h.response.data.message}`)}),await e(),m(!1)},i=async()=>{if(m(!0),o.value-=1,o.value<1){o.value=s.cart.qty,m(!1);return}const w={data:{product_id:s.cart.product_id,qty:o.value}};await p(s.cart.id,w).then(h=>{f(!0,`${s.cart.product.title}已移除`)}).catch(h=>{f(!1,`${h.response.data.message}`)}),await e(),m(!1)};return j(()=>{m(!1),V.value.addEventListener("focus",()=>{c=o.value}),V.value.addEventListener("blur",()=>{o.value<1?(f(!1,"數量不得小於1"),o.value=s.cart.qty):c!==o.value&&n()})}),H(()=>s.cart.qty,()=>{o.value=s.cart.qty}),{qty:o,myQty:V,addQty:F,delFloat:A,minusQty:i,updateQty:n,deleteItem:C,isRenewing:g,cartLoading:T,addBtnState:_,changeAddStatus:m}}},N=s=>(G("data-v-003d7310"),s=s(),J(),s),at={class:"row"},st={class:"col-md-4"},ot=["src","alt"],nt={class:"col-md-8 d-flex justify-content-between align-items-center my-3 my-lg-0"},lt={class:"d-flex justify-content-between flex-lg-column"},ct={class:"mt-3"},dt={class:"mt-3 mt-lg-0"},it={key:0,class:"mt-lg-0 text-success"},rt={key:1,class:"mt-lg-0"},mt={class:"d-flex"},ut={class:"input-group mb-3",style:{"max-width":"150px","max-height":"20px"}},ft=["disabled"],_t=N(()=>t("i",{class:"bi bi-dash-lg"},null,-1)),ht=[_t],vt=["disabled"],bt=N(()=>t("i",{class:"bi bi-plus-lg"},null,-1)),yt=[bt],gt={class:"ms-3 d-flex flex-column justify-content-center"},Ct=["disabled"],wt=N(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",class:"bi bi-trash mt-2",viewBox:"0 0 16 16"},[t("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),t("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)),xt=N(()=>t("hr",null,null,-1));function pt(s,a,l,e,p,m){const _=v("font-awesome-icon");return b(),x(P,null,[t("div",at,[t("div",st,[t("img",{src:l.cart.product.imageUrl,alt:l.cart.product.title,class:"img-fluid object-fit-cover h-100"},null,8,ot)]),t("div",nt,[t("div",lt,[t("div",ct,[t("h5",null,S(l.cart.product.title),1),t("p",dt,"單價：NT$ "+S(l.cart.product.price),1),l.cart.final_total!==l.cart.total?(b(),x("p",it,"折扣價：NT$ "+S(e.delFloat(l.cart.final_total)),1)):(b(),x("p",rt,"小計：NT$ "+S(l.cart.total),1))])]),t("div",mt,[t("div",ut,[t("button",{disabled:e.addBtnState||e.qty===1,class:"fs-4 btn btn-sm btn-secondary border-0",type:"button",onClick:a[0]||(a[0]=o=>e.minusQty())},ht,8,ft),I(t("input",{"onUpdate:modelValue":a[1]||(a[1]=o=>e.qty=o),type:"number",class:"form-control text-center",placeholder:"1",min:"1",ref:"myQty"},null,512),[[M,e.qty]]),t("button",{disabled:e.addBtnState,class:"fs-4 btn btn-sm btn-secondary border-0",type:"button",onClick:a[2]||(a[2]=o=>e.addQty())},yt,8,vt)]),t("div",gt,[t("button",{type:"button",class:"bg-white border-0",onClick:a[3]||(a[3]=o=>e.deleteItem()),disabled:e.addBtnState},[I(r(_,{icon:"spinner",class:"fa-spin"},null,512),[[D,e.cartLoading]]),wt],8,Ct)])])])]),xt],64)}const Vt=U(et,[["render",pt],["__scopeId","data-v-003d7310"]]),Bt={components:{FlowChart:Z,ProductOrderCard:Vt},setup(){const s=z(),a=y(!1),l=y(!1),{cart:e,addBtnState:p,isCartLoading:m}=E(s),{getCart:_,deleteCart:o,deleteAllCart:T,useCoupon:V,changeAddStatus:c}=s,g=async()=>{c(!0);const u={data:{code:i.value}};await V(u).then(d=>{a.value=!1,k.fire({icon:"success",confirmButtonColor:"green",title:d.data.message}).then(async B=>{B.isConfirmed&&(a.value=!0,await _(),a.value=!1)})}).catch(d=>{f(!1,d.response.data.message)}),c(!1)},C=async()=>{k.fire({icon:"warning",title:"確定刪除整個購物車？",text:"刪除後的資料無法恢復",showCancelButton:!0,reverseButtons:!0,confirmButtonColor:"red",cancelButtonColor:"gray",confirmButtonText:"確定",cancelButtonText:"取消"}).then(async u=>{u.isConfirmed?(c(!0),l.value=!0,await T().then(d=>{c(!1),l.value=!1,k.fire({title:"刪除成功",confirmButtonColor:"green",text:`全部${d.data.message}`,icon:"success"}).then(async B=>{B.isConfirmed&&(a.value=!0,await _(),a.value=!1)})}).catch(d=>{a.value=!1,k.fire({title:"刪除失敗",text:`${d.response.data.message}`,icon:"error"})})):u.isDenied&&f(!1,"動作取消")})},F=async u=>{k.fire({icon:"warning",title:`確定刪除${u.product.title}`,text:"刪除後的資料無法恢復",showCancelButton:!0,reverseButtons:!0,confirmButtonColor:"red",cancelButtonColor:"gray",confirmButtonText:"確定",cancelButtonText:"取消"}).then(async d=>{d.isConfirmed?(c(!0),await o(u.id).then(B=>{c(!1),k.fire({title:"刪除成功",confirmButtonColor:"green",text:`${u.product.title}${B.data.message}`,icon:"success"}).then(async $=>{a.value=!0,$.isConfirmed&&(await _(),a.value=!1)})}).catch(B=>{a.value=!1,c(!1),k.fire({title:"刪除失敗",text:`${B.response.data.message}`,icon:"error"})})):d.isDenied&&(f(!1,"動作取消"),c(!1))})},n=K(),i=y(null),w=y(""),h=()=>{const u={data:{user:O.value,message:w.value}};tt.sendOrder(u).then(async d=>{await _(),n.push(`/payment?id=${d.data.orderId}`)}).catch(d=>{f(!1,d.message)})},O=y({email:"",name:"",address:"",tel:""}),R=u=>/^(09)[0-9]{8}$/.test(u)?!0:"需要正確的電話號碼";return j(()=>{c(!1)}),{cart:e,cartLoading:a,isCartLoading:m,isClearCart:l,addBtnState:p,changeAddStatus:c,cartStore:s,message:w,couponCode:i,isPhone:R,user:O,goToPayment:h,clearCart:C,deleteItem:F,useMyCoupon:g,delFloat:A}}},kt={class:"container my-4"},St={class:"my-5 row justify-content-center"},qt={class:"col-lg-6"},Tt=t("h4",{class:"text-center"},"購物車資訊",-1),Ft=t("hr",null,null,-1),It={key:0,class:"text-center my-5"},Lt=t("p",{class:"fs-4 fw-bold"},"你的購物車現在沒東西喔!",-1),Nt={class:"row"},Mt={class:"col-md-6 my-3"},Pt={class:"input-group my-auto"},Ot=["disabled"],Qt={class:"col-md-6 my-3"},Ut={class:"row"},Et={key:0,class:"fs-4 fw-bold text-success col-md-12 col-7 text-end my-auto order-md-1 order-2"},jt={key:1,class:"fs-4 fw-bold col-md-12 col-6 col-7 text-end my-auto order-md-1 order-2"},Dt={class:"col-md-12 col-5 mt-md-4 text-md-end order-lg-2 order-1 my-auto"},zt=["disabled"],At=t("div",{class:"mt-1"},null,-1),Rt={class:"col-lg-6"},$t=t("h4",{class:"text-center"},"訂購人資訊",-1),Ht=t("hr",null,null,-1),Gt={class:"mb-3"},Jt=t("label",{for:"email",class:"form-label"},[t("span",{class:"text-danger"},"*"),q(" Email")],-1),Kt={class:"mb-3"},Wt=t("label",{for:"name",class:"form-label"},[t("span",{class:"text-danger"},"*"),q(" 收件人姓名")],-1),Xt={class:"mb-3"},Yt=t("label",{for:"tel",class:"form-label"},[t("span",{class:"text-danger"},"*"),q(" 收件人電話")],-1),Zt={class:"mb-3"},te=t("label",{for:"address",class:"form-label"},[t("span",{class:"text-danger"},"*"),q(" 收件人地址")],-1),ee={class:"mb-3"},ae=t("label",{for:"message",class:"form-label"},"留言",-1),se={class:"text-end"},oe=["disabled"];function ne(s,a,l,e,p,m){const _=v("myLoading"),o=v("FlowChart"),T=v("router-link"),V=v("ProductOrderCard"),c=v("font-awesome-icon"),g=v("VField"),C=v("ErrorMessage"),F=v("VForm");return b(),x(P,null,[r(_,{active:e.isCartLoading&&e.cartLoading},null,8,["active"]),r(o,{outProgress:0}),t("div",kt,[t("div",St,[t("div",qt,[Tt,Ft,e.cart.total?W("",!0):(b(),x("div",It,[Lt,r(T,{to:"/products",class:"btn btn-lg btn-success"},{default:Q(()=>[q("選購商品")]),_:1})])),(b(!0),x(P,null,X(e.cart.carts,n=>(b(),Y(V,{key:n.id,cart:n,onDeleteOneItem:e.deleteItem},null,8,["cart","onDeleteOneItem"]))),128)),t("div",Nt,[t("div",Mt,[t("div",Pt,[I(t("input",{type:"text",class:"form-control",placeholder:"請輸入折扣碼","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":a[0]||(a[0]=n=>e.couponCode=n)},null,512),[[M,e.couponCode]]),t("button",{disabled:e.addBtnState||!e.cart.total,class:"btn btn-outline-success",type:"button",id:"button-addon2",onClick:a[1]||(a[1]=n=>e.useMyCoupon())}," 套用 ",8,Ot)])]),t("div",Qt,[t("div",Ut,[e.cart.final_total!==e.cart.total?(b(),x("span",Et,"折扣價：NT$ "+S(e.delFloat(e.cart.final_total)),1)):(b(),x("span",jt,"總計：NT$ "+S(e.cart.total),1)),t("div",Dt,[t("button",{type:"button",class:"btn btn-outline-success",onClick:a[2]||(a[2]=n=>e.clearCart()),disabled:e.addBtnState||!e.cart.total},[I(r(c,{icon:"spinner",class:"fa-spin"},null,512),[[D,e.isClearCart]]),q(" 清空購物車 ")],8,zt)])])])]),At]),t("div",Rt,[$t,Ht,r(F,{onSubmit:a[8]||(a[8]=n=>e.goToPayment()),class:"bg-light p-3 rounded",ref:"form"},{default:Q(({errors:n})=>[t("div",Gt,[Jt,r(g,{id:"email",name:"email",type:"email",class:L(["form-control",{"is-invalid":n.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:e.user.email,"onUpdate:modelValue":a[3]||(a[3]=i=>e.user.email=i)},null,8,["class","modelValue"]),r(C,{name:"email",class:"invalid-feedback"})]),t("div",Kt,[Wt,r(g,{id:"name",name:"姓名",type:"text",class:L(["form-control",{"is-invalid":n.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:e.user.name,"onUpdate:modelValue":a[4]||(a[4]=i=>e.user.name=i)},null,8,["class","modelValue"]),r(C,{name:"姓名",class:"invalid-feedback"})]),t("div",Xt,[Yt,r(g,{id:"tel",name:"電話",type:"text",class:L(["form-control",{"is-invalid":n.電話}]),placeholder:"請輸入電話",rules:e.isPhone,modelValue:e.user.tel,"onUpdate:modelValue":a[5]||(a[5]=i=>e.user.tel=i)},null,8,["class","rules","modelValue"]),r(C,{name:"電話",class:"invalid-feedback"})]),t("div",Zt,[te,r(g,{id:"address",name:"地址",type:"text",class:L(["form-control",{"is-invalid":n.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:e.user.address,"onUpdate:modelValue":a[6]||(a[6]=i=>e.user.address=i)},null,8,["class","modelValue"]),r(C,{name:"地址",class:"invalid-feedback"})]),t("div",ee,[ae,I(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":a[7]||(a[7]=i=>e.message=i)},null,512),[[M,e.message]])]),t("div",se,[t("button",{type:"submit",class:"btn btn-success",disabled:e.addBtnState||!e.cart.total}," 送出訂單 ",8,oe)])]),_:1},512)])])])],64)}const ue=U(Bt,[["render",ne]]);export{ue as default};
