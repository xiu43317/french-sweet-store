import{_ as E,r as u,y as q,d as A,Z as G,i as w,o as a,c as n,a as t,w as h,v as b,F as k,l as V,$ as S,q as $,f as g,Y as U,t as x}from"./index-moY6mszh.js";import{D as Y}from"./DeleteModal-SXh5QWmo.js";import{B as Z}from"./BottomPagination-Xer6X3Ol.js";const C="https://vue3-course-api.hexschool.io/v2",F="rock",j={props:["isNew","tempProduct","currentPage"],emits:["getProducts"],setup(c,e){let _;const o=u(null),v=u(null),d=u({}),m=u(!1),l=u(null),r=()=>{d.value.origin_price<1||d.value.price<1?alert("價格不得小於1"):c.isNew?U.post(`${C}/api/${F}/admin/product`,{data:d.value}).then(p=>{alert(p.data.message),d.value={},y(),i()}).catch(p=>{alert(p.response.data.message)}):U.put(`${C}/api/${F}/admin/product/${c.tempProduct.id}`,{data:d.value}).then(p=>{alert(p.data.message),d.value={},y(),i()}).catch(p=>{alert(p.response.data.message)})},f=()=>{d.value.imagesUrl=[],d.value.imagesUrl.push("")},y=()=>{e.emit("getProducts",c.currentPage)},s=()=>{d.value=c.tempProduct,_.show()},i=()=>{_.hide()},M=()=>{const p=o.value.files[0],D=new FormData;D.append("file-to-upload",p),U.post(`${C}/api/${F}/admin/upload`,D).then(P=>{d.value.imageUrl=P.data.imageUrl,v.value.value=""}).catch(P=>{alert(P.response.data.message)})},T=p=>{const P=document.querySelectorAll(".uploadImages")[p].files[0],I=new FormData;I.append("file-to-upload",P),U.post(`${C}/api/${F}/admin/upload`,I).then(N=>{d.value.imagesUrl[p]=N.data.imageUrl}).catch(N=>{alert(N.response.data.message)})};return q(()=>c.isNew,()=>{m.value=c.isNew}),A(()=>{_=new G(l.value,{keyboard:!1}),o.value=v.value,o.value.addEventListener("change",M)}),{product:d,myNew:m,updateProduct:r,createImages:f,openModal:s,hideModal:i,uploadFile:M,uploadFiles:T,modal:l,formFile:v,fileInput:o}}},z={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},H={class:"modal-dialog modal-xl"},J={class:"modal-content border-0"},K={class:"modal-header bg-secondary text-white"},O={id:"productModalLabel",class:"modal-title"},Q={key:0},R={key:1},W=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},tt={class:"row"},ot={class:"col-sm-4"},et={class:"mb-2"},lt={class:"mb-3"},st=t("h3",{class:"mb-3"},"主要圖片",-1),at=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),nt={class:"mb-3"},dt=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),it=["src","alt"],rt=t("h3",{class:"mb-3"},"多圖新增",-1),ct={key:0},ut={class:"mb-3"},mt=t("label",{for:"imagesUrl",class:"form-label"},"輸入圖片網址",-1),pt=["onUpdate:modelValue"],_t={class:"mb-3"},ht=t("label",{for:"formFiles",class:"form-label"},"上傳檔案",-1),bt=["onChange"],vt=["src"],ft={key:0},gt={key:1},yt={key:1},wt={class:"col-sm-8"},Ut={class:"mb-3"},kt=t("label",{for:"title",class:"form-label"},"標題",-1),Mt={class:"row"},Pt={class:"mb-3 col-md-6"},xt=t("label",{for:"category",class:"form-label"},"分類",-1),Ct={class:"mb-3 col-md-6"},Ft=t("label",{for:"unit",class:"form-label"},"單位",-1),Vt={class:"row"},Dt={class:"mb-3 col-md-6"},Nt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),It={class:"mb-3 col-md-6"},Lt=t("label",{for:"price",class:"form-label"},"售價",-1),Bt=t("hr",null,null,-1),Et={class:"mb-3"},At=t("label",{for:"description",class:"form-label"},"產品描述",-1),Tt={class:"mb-3"},qt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Gt={class:"mb-3"},St=t("label",{for:"presever",class:"form-label"},"保存方式",-1),$t={class:"mb-3 row"},Yt={class:"mb-3 col-md-6"},Zt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),jt={class:"mb-3 col-md-6 row"},zt=t("label",{for:"stars",class:"col-sm-3 col-form-label"},"推薦度",-1),Ht={class:"col-sm-5 mt-1"},Jt=["onClick"],Kt={key:0},Ot={key:1},Qt={class:"modal-footer"};function Rt(c,e,_,o,v,d){const m=w("font-awesome-icon");return a(),n("div",z,[t("div",H,[t("div",J,[t("div",K,[t("h5",O,[_.isNew?(a(),n("span",Q,"新增產品")):(a(),n("span",R,"編輯產品"))]),W]),t("div",X,[t("div",tt,[t("div",ot,[t("div",et,[t("div",lt,[st,at,h(t("input",{id:"imageUrl",type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=l=>o.product.imageUrl=l)},null,512),[[b,o.product.imageUrl]])]),t("div",nt,[dt,t("input",{class:"form-control",type:"file",id:"formFile",ref:"formFile",onChange:e[1]||(e[1]=l=>o.uploadFile())},null,544)]),t("img",{class:"img-fluid",src:o.product.imageUrl,alt:o.product.title},null,8,it)]),rt,Array.isArray(o.product.imagesUrl)?(a(),n("div",ct,[(a(!0),n(k,null,V(o.product.imagesUrl,(l,r)=>(a(),n(k,{key:r},[t("div",ut,[mt,h(t("input",{id:"imagesUrl",type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":f=>o.product.imagesUrl[r]=f},null,8,pt),[[b,o.product.imagesUrl[r]]])]),t("div",_t,[ht,t("input",{id:"formFiles",class:"form-control uploadImages",type:"file",onChange:f=>o.uploadFiles(r)},null,40,bt),t("img",{class:"img-fluid",src:o.product.imagesUrl[r],alt:"相關產品"},null,8,vt)])],64))),128)),!o.product.imagesUrl.length||o.product.imagesUrl[o.product.imagesUrl.length-1]?(a(),n("div",ft,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=l=>o.product.imagesUrl.push(""))}," 新增圖片 ")])):(a(),n("div",gt,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=l=>o.product.imagesUrl.pop())}," 刪除圖片 ")]))])):(a(),n("div",yt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=l=>o.createImages())}," 新增圖片 ")]))]),t("div",wt,[t("div",Ut,[kt,h(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=l=>o.product.title=l)},null,512),[[b,o.product.title]])]),t("div",Mt,[t("div",Pt,[xt,h(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=l=>o.product.category=l)},null,512),[[b,o.product.category]])]),t("div",Ct,[Ft,h(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=l=>o.product.unit=l)},null,512),[[b,o.product.unit]])])]),t("div",Vt,[t("div",Dt,[Nt,h(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=l=>o.product.origin_price=l)},null,512),[[b,o.product.origin_price,void 0,{number:!0}]])]),t("div",It,[Lt,h(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=l=>o.product.price=l)},null,512),[[b,o.product.price,void 0,{number:!0}]])])]),Bt,t("div",Et,[At,h(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=l=>o.product.description=l)},`\r
                `,512),[[b,o.product.description]])]),t("div",Tt,[qt,h(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=l=>o.product.content=l)},`\r
                `,512),[[b,o.product.content]])]),t("div",Gt,[St,h(t("textarea",{name:"presever",type:"text",id:"presever",class:"form-control",placeholder:"請輸入保存方式","onUpdate:modelValue":e[12]||(e[12]=l=>o.product.presever=l)},`\r
                `,512),[[b,o.product.presever]])]),t("div",$t,[t("div",Yt,[h(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[13]||(e[13]=l=>o.product.is_enabled=l)},null,512),[[S,o.product.is_enabled]]),Zt]),t("div",jt,[zt,t("div",Ht,[(a(),n(k,null,V(5,(l,r)=>t("a",{href:"#",key:r,onClick:$(f=>o.product.stars=r+1,["prevent"])},[r+1<=_.tempProduct.stars?(a(),n("span",Kt,[g(m,{icon:["fas","star"]})])):(a(),n("span",Ot,[g(m,{icon:["far","star"]})]))],8,Jt)),64))])])])])])]),t("div",Qt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[14]||(e[14]=l=>o.hideModal())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[15]||(e[15]=l=>o.updateProduct())}," 確認 ")])])])],512)}const Wt=E(j,[["render",Rt]]),L="https://vue3-course-api.hexschool.io/v2",B="rock",Xt={components:{EditModal:Wt,DeleteModal:Y,BottomPagination:Z},setup(){const c=u({imagesUrl:[]}),e=u([]),_=u(!0),o=u({}),v=u(null),d=u(null),m=u(!1),l=u(1),r=(s=1)=>{m.value=!0,U.get(`${L}/api/${B}/admin/products?page=${s}`).then(i=>{e.value=i.data.products,o.value=i.data.pagination,l.value=s,m.value=!1}).catch(i=>{alert(i.response.data.message),m.value=!1})},f=(s,i={})=>{s==="new"?(c.value={imagesUrl:[]},_.value=!0,setTimeout(()=>{v.value.openModal()},500)):s==="edit"?(c.value={...i},c.value.imagesUrl||(c.value.imagesUrl=[]),_.value=!1,setTimeout(()=>{v.value.openModal()},500)):s==="delete"&&(c.value=i,setTimeout(()=>{d.value.openModal()},500))},y=s=>{U.delete(`${L}/api/${B}/admin/product/${s}`).then(i=>{alert(i.data.message),d.value.hideModal(),r(l.value)}).catch(i=>{alert(i.response.data.message),d.value.hideModal()})};return A(()=>{r()}),{products:e,isNew:_,pages:o,tempProduct:c,productModal:v,delProductModal:d,isLoading:m,currentPage:l,getProducts:r,openModal:f,deleteProduct:y}}},to=t("div",{class:"h3 text-center mt-4"},"後台產品列表",-1),oo={class:"container"},eo={class:"text-end mt-4"},lo={class:"table mt-4"},so=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"150"},"商品推薦"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),ao={key:0},no={key:1},io=t("i",{class:"far fa-star"},null,-1),ro=[io],co={class:"text-end"},uo={class:"text-end"},mo={key:0,class:"text-success"},po={key:1},_o={class:"btn-group"},ho=["onClick"],bo=["onClick"];function vo(c,e,_,o,v,d){const m=w("myLoading"),l=w("font-awesome-icon"),r=w("EditModal"),f=w("DeleteModal"),y=w("BottomPagination");return a(),n(k,null,[g(m,{active:o.isLoading},null,8,["active"]),to,t("div",oo,[t("div",eo,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=s=>o.openModal("new"))}," 建立新的產品 ")]),t("table",lo,[so,t("tbody",null,[(a(!0),n(k,null,V(o.products,s=>(a(),n("tr",{key:s.id},[t("td",null,x(s.category),1),t("td",null,x(s.title),1),t("td",null,[(a(),n(k,null,V(5,(i,M)=>t("span",{key:M},[M+1<=s.stars?(a(),n("span",ao,[g(l,{icon:"fas fa-star"})])):(a(),n("span",no,ro))])),64))]),t("td",co,x(s.origin_price),1),t("td",uo,x(s.price),1),t("td",null,[s.is_enabled?(a(),n("span",mo,"啟用")):(a(),n("span",po,"未啟用"))]),t("td",null,[t("div",_o,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>o.openModal("edit",s)}," 編輯 ",8,ho),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>o.openModal("delete",s)}," 刪除 ",8,bo)])])]))),128))])]),g(r,{"is-new":o.isNew,"temp-product":o.tempProduct,"current-page":o.currentPage,onGetProducts:o.getProducts,ref:"productModal"},null,8,["is-new","temp-product","current-page","onGetProducts"]),g(f,{product:o.tempProduct,onDeleteItem:o.deleteProduct,ref:"delProductModal"},null,8,["product","onDeleteItem"]),g(y,{pages:o.pages,onEmitPage:o.getProducts,ref:"pagination"},null,8,["pages","onEmitPage"])])],64)}const wo=E(Xt,[["render",vo]]);export{wo as default};
