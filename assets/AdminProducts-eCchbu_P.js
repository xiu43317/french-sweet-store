import{_ as E,r as i,y as B,d as T,M as G,i as P,o as n,c as a,a as t,w as h,v as f,F as k,l as D,Z as S,D as q,f as w,Y as M,u as R,t as C}from"./index-nkGAcBuK.js";import{D as Y}from"./DeleteModal-9XccuGv3.js";import{A as Z}from"./BottomPagination-ZF7uivsH.js";const F="https://vue3-course-api.hexschool.io/v2",V="rock",j={props:["isNew","tempProduct","currentPage"],emits:["getProducts"],setup(p,e){let _;const o=i(null),v=i(null),r=i({}),u=i(!1),s=i(null),d=()=>{p.isNew?M.post(`${F}/api/${V}/admin/product`,{data:p.tempProduct}).then(l=>{alert(l.data.message),U(),g()}).catch(l=>{alert(l.response.data.message)}):M.put(`${F}/api/${V}/admin/product/${p.tempProduct.id}`,{data:p.tempProduct}).then(l=>{alert(l.data.message),U(),g()}).catch(l=>{alert(l.response.data.message)})},b=()=>{r.value.imagesUrl=[],r.value.imagesUrl.push("")},U=()=>{e.emit("getProducts",p.currentPage)},c=()=>{r.value=p.tempProduct,_.show()},g=()=>{_.hide()},y=()=>{const l=o.value.files[0],N=new FormData;N.append("file-to-upload",l),this.$http.post(`${F}/api/${V}/admin/upload`,N).then(x=>{r.value.imageUrl=x.data.imageUrl}).catch(x=>{alert(x.response.data.message)})},m=l=>{const x=document.querySelectorAll(".uploadImages")[l].files[0],A=new FormData;A.append("file-to-upload",x),M.post(`${F}/api/${V}/admin/upload`,A).then(I=>{r.value.imagesUrl[l]=I.data.imageUrl}).catch(I=>{alert(I.response.data.message)})};return B(()=>p.isNew,()=>{u.value=p.isNew}),T(()=>{_=new G(s.value,{keyboard:!1}),o.value=v.value,o.value.addEventListener("change",y)}),{product:r,myNew:u,updateProduct:d,createImages:b,openModal:c,hideModal:g,uploadFile:y,uploadFiles:m,modal:s,formFile:v,fileInput:o}}},z={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},H={class:"modal-dialog modal-xl"},J={class:"modal-content border-0"},K={class:"modal-header bg-secondary text-white"},O={id:"productModalLabel",class:"modal-title"},Q={key:0},W={key:1},X=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),tt={class:"modal-body"},ot={class:"row"},et={class:"col-sm-4"},st={class:"mb-2"},lt={class:"mb-3"},nt=t("h3",{class:"mb-3"},"主要圖片",-1),at=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),dt={class:"mb-3"},ct=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),it=["src"],rt=t("h3",{class:"mb-3"},"多圖新增",-1),ut={key:0},mt={class:"mb-3"},pt=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),_t=["onUpdate:modelValue"],ht={class:"mb-3"},bt=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),ft=["onChange"],gt=["src"],vt={key:0},yt={key:1},wt={key:1},Ut={class:"col-sm-8"},Pt={class:"mb-3"},kt=t("label",{for:"title",class:"form-label"},"標題",-1),Mt={class:"row"},xt={class:"mb-3 col-md-6"},Ct=t("label",{for:"category",class:"form-label"},"分類",-1),Ft={class:"mb-3 col-md-6"},Vt=t("label",{for:"price",class:"form-label"},"單位",-1),Dt={class:"row"},Nt={class:"mb-3 col-md-6"},It=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Lt={class:"mb-3 col-md-6"},At=t("label",{for:"price",class:"form-label"},"售價",-1),$t=t("hr",null,null,-1),Et={class:"mb-3"},Tt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Bt={class:"mb-3"},Gt=t("label",{for:"content",class:"form-label"},"說明內容",-1),St={class:"mb-3 row"},qt={class:"mb-3 col-md-6"},Rt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Yt={class:"mb-3 col-md-6 row"},Zt=t("label",{for:"price",class:"col-sm-3 col-form-label"},"推薦度",-1),jt={class:"col-sm-5 mt-1"},zt=["onClick"],Ht={key:0},Jt={key:1},Kt={class:"modal-footer"};function Ot(p,e,_,o,v,r){const u=P("font-awesome-icon");return n(),a("div",z,[t("div",H,[t("div",J,[t("div",K,[t("h5",O,[_.isNew?(n(),a("span",Q,"新增產品")):(n(),a("span",W,"編輯產品"))]),X]),t("div",tt,[t("div",ot,[t("div",et,[t("div",st,[t("div",lt,[nt,at,h(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>o.product.imageUrl=s)},null,512),[[f,o.product.imageUrl]])]),t("div",dt,[ct,t("input",{class:"form-control",type:"file",id:"formFile",ref:"formFile",onChange:e[1]||(e[1]=s=>o.uploadFile())},null,544)]),t("img",{class:"img-fluid",src:o.product.imageUrl},null,8,it)]),rt,Array.isArray(o.product.imagesUrl)?(n(),a("div",ut,[(n(!0),a(k,null,D(o.product.imagesUrl,(s,d)=>(n(),a(k,{key:d},[t("div",mt,[pt,h(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":b=>o.product.imagesUrl[d]=b},null,8,_t),[[f,o.product.imagesUrl[d]]])]),t("div",ht,[bt,t("input",{class:"form-control uploadImages",type:"file",onChange:b=>o.uploadFiles(d)},null,40,ft),t("img",{class:"img-fluid",src:o.product.imagesUrl[d]},null,8,gt)])],64))),128)),!o.product.imagesUrl.length||o.product.imagesUrl[o.product.imagesUrl.length-1]?(n(),a("div",vt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=s=>o.product.imagesUrl.push(""))}," 新增圖片 ")])):(n(),a("div",yt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=s=>o.product.imagesUrl.pop())}," 刪除圖片 ")]))])):(n(),a("div",wt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=s=>o.createImages())}," 新增圖片 ")]))]),t("div",Ut,[t("div",Pt,[kt,h(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=s=>o.product.title=s)},null,512),[[f,o.product.title]])]),t("div",Mt,[t("div",xt,[Ct,h(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=s=>o.product.category=s)},null,512),[[f,o.product.category]])]),t("div",Ft,[Vt,h(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=s=>o.product.unit=s)},null,512),[[f,o.product.unit]])])]),t("div",Dt,[t("div",Nt,[It,h(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=s=>o.product.origin_price=s)},null,512),[[f,o.product.origin_price,void 0,{number:!0}]])]),t("div",Lt,[At,h(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=s=>o.product.price=s)},null,512),[[f,o.product.price,void 0,{number:!0}]])])]),$t,t("div",Et,[Tt,h(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=s=>o.product.description=s)},`\r
                `,512),[[f,o.product.description]])]),t("div",Bt,[Gt,h(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=s=>o.product.content=s)},`\r
                `,512),[[f,o.product.content]])]),t("div",St,[t("div",qt,[h(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[12]||(e[12]=s=>o.product.is_enabled=s)},null,512),[[S,o.product.is_enabled]]),Rt]),t("div",Yt,[Zt,t("div",jt,[(n(),a(k,null,D(5,(s,d)=>t("a",{href:"#",key:d,onClick:q(b=>o.product.stars=d+1,["prevent"])},[d+1<=_.tempProduct.stars?(n(),a("span",Ht,[w(u,{icon:["fas","star"]})])):(n(),a("span",Jt,[w(u,{icon:["far","star"]})]))],8,zt)),64))])])])])])]),t("div",Kt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[13]||(e[13]=s=>o.hideModal())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=s=>o.updateProduct())}," 確認 ")])])])],512)}const Qt=E(j,[["render",Ot]]),L="https://vue3-course-api.hexschool.io/v2",$="rock",Wt={components:{editProduct:Qt,deleteProduct:Y,AdminPagination:Z},setup(p){const e=i({imagesUrl:[]}),_=i([]),o=i(!0),v=i({}),r=i(null),u=i(null),s=i(!1),d=i(1),b=R(),U=()=>{M.post(`${L}/api/user/check`).then(m=>{c()}).catch(m=>{b.push("/login")})},c=(m=1)=>{s.value=!0,M.get(`${L}/api/${$}/admin/products?page=${m}`).then(l=>{_.value=l.data.products,v.value=l.data.pagination,s.value=!1,d.value=m}).catch(l=>{console.dir(l),s.value=!1})},g=(m,l={})=>{m==="new"?(e.value={imagesUrl:[]},o.value=!0,setTimeout(()=>{r.value.openModal()},500)):m==="edit"?(e.value={...l},e.value.imagesUrl||(e.value.imagesUrl=[]),o.value=!1,setTimeout(()=>{r.value.openModal()},500)):m==="delete"&&(e.value=l,setTimeout(()=>{u.value.openModal()},500))},y=m=>{M.delete(`${L}/api/${$}/admin/product/${m}`).then(l=>{alert(l.data.message),u.value.hideModal(),c(d.value)}).catch(l=>{alert(l.response.data.message),u.value.hideModal()})};return T(()=>{c()}),{products:_,isNew:o,pages:v,tempProduct:e,productModal:r,delProductModal:u,isLoading:s,currentPage:d,checkLogin:U,getProducts:c,openModal:g,deleteProduct:y}}},Xt=t("div",{class:"h3 text-center mt-4"},"後台產品列表",-1),to={class:"container"},oo={class:"text-end mt-4"},eo={class:"table mt-4"},so=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"150"},"商品推薦"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),lo={key:0},no={key:1},ao=t("i",{class:"far fa-star"},null,-1),co=[ao],io={class:"text-end"},ro={class:"text-end"},uo={key:0,class:"text-success"},mo={key:1},po={class:"btn-group"},_o=["onClick"],ho=["onClick"];function bo(p,e,_,o,v,r){const u=P("myLoading"),s=P("font-awesome-icon"),d=P("edit-product"),b=P("delete-product"),U=P("admin-pagination");return n(),a(k,null,[w(u,{active:o.isLoading},null,8,["active"]),Xt,t("div",to,[t("div",oo,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=c=>o.openModal("new"))}," 建立新的產品 ")]),t("table",eo,[so,t("tbody",null,[(n(!0),a(k,null,D(o.products,c=>(n(),a("tr",{key:c.id},[t("td",null,C(c.category),1),t("td",null,C(c.title),1),t("td",null,[(n(),a(k,null,D(5,(g,y)=>t("span",{key:y},[y+1<=c.stars?(n(),a("span",lo,[w(s,{icon:"fas fa-star"})])):(n(),a("span",no,co))])),64))]),t("td",io,C(c.origin_price),1),t("td",ro,C(c.price),1),t("td",null,[c.is_enabled?(n(),a("span",uo,"啟用")):(n(),a("span",mo,"未啟用"))]),t("td",null,[t("div",po,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:g=>o.openModal("edit",c)}," 編輯 ",8,_o),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:g=>o.openModal("delete",c)}," 刪除 ",8,ho)])])]))),128))])]),w(d,{"is-new":o.isNew,"temp-product":o.tempProduct,"current-page":o.currentPage,onGetProducts:o.getProducts,ref:"productModal"},null,8,["is-new","temp-product","current-page","onGetProducts"]),w(b,{product:o.tempProduct,onDeleteItem:o.deleteProduct,ref:"delProductModal"},null,8,["product","onDeleteItem"]),w(U,{pages:o.pages,onEmitPage:o.getProducts,ref:"pagination"},null,8,["pages","onEmitPage"])])],64)}const yo=E(Wt,[["render",bo]]);export{yo as default};
