import{_ as $,M as F,i as h,o as i,c as n,a as t,w as a,v as p,F as _,l as w,Z as V,D as L,f as m,t as v}from"./index-KtGT-tiA.js";import{D}from"./DeleteModal-8Jkyup88.js";import{a as I}from"./BottomPagination-dUngVKRZ.js";const P="https://vue3-course-api.hexschool.io/v2",y="rock",N={data(){return{product:{},new:!1}},props:["isNew","tempProduct","currentPage"],methods:{updateProduct(){this.isNew?this.$http.post(`${P}/api/${y}/admin/product`,{data:this.tempProduct}).then(l=>{alert(l.data.message),this.getProducts(),this.hideModal()}).catch(l=>{alert(l.response.data.message)}):this.$http.put(`${P}/api/${y}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(l=>{alert(l.data.message),this.getProducts(),this.hideModal()}).catch(l=>{alert(l.response.data.message)})},createImages(){this.Product.imagesUrl=[],this.Product.imagesUrl.push("")},getProducts(){this.$emit("getProducts",this.currentPage)},openModal(){this.product=this.tempProduct,this.myModal.show()},hideModal(){this.myModal.hide()},uploadFile(){const l=this.fileInput.files[0],e=new FormData;e.append("file-to-upload",l),this.$http.post(`${P}/api/${y}/admin/upload`,e).then(u=>{this.Product.imageUrl=u.data.imageUrl}).catch(u=>{alert(u.response.data.message)})},uploadFiles(l){const u=document.querySelectorAll(".uploadImages")[l].files[0],b=new FormData;b.append("file-to-upload",u),this.$http.post(`${P}/api/${y}/admin/upload`,b).then(o=>{this.Product.imagesUrl[l]=o.data.imageUrl}).catch(o=>{alert(o.response.data.message)})}},watch:{isNew(){this.new=this.isNew}},mounted(){this.myModal=new F(this.$refs.Modal,{keyboard:!1}),this.fileInput=this.$refs.formFile,this.fileInput.addEventListener("change",this.uploadFile)}},A={id:"productModal",ref:"Modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},E={class:"modal-dialog modal-xl"},T={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},G={id:"productModalLabel",class:"modal-title"},S={key:0},q={key:1},Z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},z={class:"row"},H={class:"col-sm-4"},J={class:"mb-2"},K={class:"mb-3"},O=t("h3",{class:"mb-3"},"主要圖片",-1),Q=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),R={class:"mb-3"},W=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),X=["src"],Y=t("h3",{class:"mb-3"},"多圖新增",-1),tt={key:0},et={class:"mb-3"},ot=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),st=["onUpdate:modelValue"],lt={class:"mb-3"},it=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),nt=["onChange"],dt=["src"],rt={key:0},ct={key:1},at={key:1},ut={class:"col-sm-8"},pt={class:"mb-3"},mt=t("label",{for:"title",class:"form-label"},"標題",-1),ht={class:"row"},_t={class:"mb-3 col-md-6"},ft=t("label",{for:"category",class:"form-label"},"分類",-1),bt={class:"mb-3 col-md-6"},gt=t("label",{for:"price",class:"form-label"},"單位",-1),vt={class:"row"},Pt={class:"mb-3 col-md-6"},yt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),wt={class:"mb-3 col-md-6"},Mt=t("label",{for:"price",class:"form-label"},"售價",-1),Ut=t("hr",null,null,-1),kt={class:"mb-3"},xt=t("label",{for:"description",class:"form-label"},"產品描述",-1),$t={class:"mb-3"},Ct=t("label",{for:"content",class:"form-label"},"說明內容",-1),Ft={class:"mb-3 row"},Vt={class:"mb-3 col-md-6"},Lt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Dt={class:"mb-3 col-md-6 row"},It=t("label",{for:"price",class:"col-sm-3 col-form-label"},"推薦度",-1),Nt={class:"col-sm-5 mt-1"},At=["onClick"],Et={key:0},Tt={key:1},Bt={class:"modal-footer"};function Gt(l,e,u,b,o,d){const g=h("font-awesome-icon");return i(),n("div",A,[t("div",E,[t("div",T,[t("div",B,[t("h5",G,[u.isNew?(i(),n("span",S,"新增產品")):(i(),n("span",q,"編輯產品"))]),Z]),t("div",j,[t("div",z,[t("div",H,[t("div",J,[t("div",K,[O,Q,a(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>o.product.imageUrl=s)},null,512),[[p,o.product.imageUrl]])]),t("div",R,[W,t("input",{class:"form-control",type:"file",id:"formFile",ref:"formFile",onChange:e[1]||(e[1]=s=>d.uploadFile())},null,544)]),t("img",{class:"img-fluid",src:o.product.imageUrl},null,8,X)]),Y,Array.isArray(o.product.imagesUrl)?(i(),n("div",tt,[(i(!0),n(_,null,w(o.product.imagesUrl,(s,r)=>(i(),n(_,{key:r},[t("div",et,[ot,a(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":f=>o.product.imagesUrl[r]=f},null,8,st),[[p,o.product.imagesUrl[r]]])]),t("div",lt,[it,t("input",{class:"form-control uploadImages",type:"file",onChange:f=>d.uploadFiles(r)},null,40,nt),t("img",{class:"img-fluid",src:o.product.imagesUrl[r]},null,8,dt)])],64))),128)),!o.product.imagesUrl.length||o.product.imagesUrl[o.product.imagesUrl.length-1]?(i(),n("div",rt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=s=>o.product.imagesUrl.push(""))}," 新增圖片 ")])):(i(),n("div",ct,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=s=>o.product.imagesUrl.pop())}," 刪除圖片 ")]))])):(i(),n("div",at,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=s=>d.createImages())}," 新增圖片 ")]))]),t("div",ut,[t("div",pt,[mt,a(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=s=>o.product.title=s)},null,512),[[p,o.product.title]])]),t("div",ht,[t("div",_t,[ft,a(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=s=>o.product.category=s)},null,512),[[p,o.product.category]])]),t("div",bt,[gt,a(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=s=>o.product.unit=s)},null,512),[[p,o.product.unit]])])]),t("div",vt,[t("div",Pt,[yt,a(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=s=>o.product.origin_price=s)},null,512),[[p,o.product.origin_price,void 0,{number:!0}]])]),t("div",wt,[Mt,a(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=s=>o.product.price=s)},null,512),[[p,o.product.price,void 0,{number:!0}]])])]),Ut,t("div",kt,[xt,a(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=s=>o.product.description=s)},`\r
                `,512),[[p,o.product.description]])]),t("div",$t,[Ct,a(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=s=>o.product.content=s)},`\r
                `,512),[[p,o.product.content]])]),t("div",Ft,[t("div",Vt,[a(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[12]||(e[12]=s=>o.product.is_enabled=s)},null,512),[[V,o.product.is_enabled]]),Lt]),t("div",Dt,[It,t("div",Nt,[(i(),n(_,null,w(5,(s,r)=>t("a",{href:"#",key:r,onClick:L(f=>o.product.stars=r+1,["prevent"])},[r+1<=u.tempProduct.stars?(i(),n("span",Et,[m(g,{icon:["fas","star"]})])):(i(),n("span",Tt,[m(g,{icon:["far","star"]})]))],8,At)),64))])])])])])]),t("div",Bt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[13]||(e[13]=s=>d.hideModal())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=s=>d.updateProduct())}," 確認 ")])])])],512)}const St=$(N,[["render",Gt]]),M="https://vue3-course-api.hexschool.io/v2",x="rock",qt={data(){return{products:[],isNew:!0,pagination:{},tempProduct:{imagesUrl:[]},editModal:"",delModel:"",isLoading:!1,currentPage:1}},methods:{checkLogin(){this.$http.post(`${M}/api/user/check`).then(l=>{this.getProducts()}).catch(l=>{this.$router.push("/login")})},getProducts(l=1){this.isLoading=!0,this.$http.get(`${M}/api/${x}/admin/products?page=${l}`).then(e=>{this.products=e.data.products,this.pagination=e.data.pagination,this.isLoading=!1,this.currentPage=l}).catch(e=>{console.dir(e),this.isLoading=!1})},openModal(l,e={}){l==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,setTimeout(()=>{this.$refs.productModal.openModal()},500)):l==="edit"?(this.tempProduct={...e},this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[]),this.isNew=!1,setTimeout(()=>{this.$refs.productModal.openModal()},500)):l==="delete"&&(this.tempProduct=e,setTimeout(()=>{this.$refs.delProductModal.openModal()},500))},deleteProduct(l){this.$http.delete(`${M}/api/${x}/admin/product/${l}`).then(e=>{alert(e.data.message),this.$refs.delProductModal.hideModal(),this.getProducts(this.currentPage)}).catch(e=>{alert(e.response.data.message),this.$refs.delProductModal.hideModal()})}},mounted(){this.getProducts(),this.editModal=this.$refs.productModal,this.delModel=this.$refs.delProductModal},components:{editProduct:St,deleteProduct:D,adminPagination:I}},Zt=t("div",{class:"h3 text-center mt-4"},"後台產品列表",-1),jt={class:"container"},zt={class:"text-end mt-4"},Ht={class:"table mt-4"},Jt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"150"},"商品推薦"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Kt={key:0},Ot={key:1},Qt=t("i",{class:"far fa-star"},null,-1),Rt=[Qt],Wt={class:"text-end"},Xt={class:"text-end"},Yt={key:0,class:"text-success"},te={key:1},ee={class:"btn-group"},oe=["onClick"],se=["onClick"];function le(l,e,u,b,o,d){const g=h("myLoading"),s=h("font-awesome-icon"),r=h("edit-product"),f=h("delete-product"),C=h("admin-pagination");return i(),n(_,null,[m(g,{active:o.isLoading},null,8,["active"]),Zt,t("div",jt,[t("div",zt,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=c=>d.openModal("new"))}," 建立新的產品 ")]),t("table",Ht,[Jt,t("tbody",null,[(i(!0),n(_,null,w(o.products,c=>(i(),n("tr",{key:c.id},[t("td",null,v(c.category),1),t("td",null,v(c.title),1),t("td",null,[(i(),n(_,null,w(5,(U,k)=>t("span",{key:k},[k+1<=c.stars?(i(),n("span",Kt,[m(s,{icon:"fas fa-star"})])):(i(),n("span",Ot,Rt))])),64))]),t("td",Wt,v(c.origin_price),1),t("td",Xt,v(c.price),1),t("td",null,[c.is_enabled?(i(),n("span",Yt,"啟用")):(i(),n("span",te,"未啟用"))]),t("td",null,[t("div",ee,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:U=>d.openModal("edit",c)}," 編輯 ",8,oe),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:U=>d.openModal("delete",c)}," 刪除 ",8,se)])])]))),128))])]),m(r,{"is-new":o.isNew,"temp-product":o.tempProduct,"current-page":o.currentPage,onGetProducts:d.getProducts,ref:"productModal"},null,8,["is-new","temp-product","current-page","onGetProducts"]),m(f,{product:o.tempProduct,onDeleteItem:d.deleteProduct,ref:"delProductModal"},null,8,["product","onDeleteItem"]),m(C,{pages:o.pagination,onEmitPage:d.getProducts,ref:"pagination"},null,8,["pages","onEmitPage"])])],64)}const re=$(qt,[["render",le]]);export{re as default};
