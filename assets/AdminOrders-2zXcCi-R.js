import{_ as O,M as v,o as d,c as n,a as e,t as o,k as y,F as m,l as M,w as f,Z as k,i as _,f as p,h as $}from"./index-q9p8AbdN.js";import{D as w}from"./DeleteModal-Kzm49nS2.js";import{A}from"./BottomPagination-bTy95Fm2.js";const P={data(){return{tempOrder:{user:{}},orderModal:""}},props:["selectedOrder"],methods:{date(t){return new Date(t*1e3).toLocaleDateString()},currency(t){return`${parseInt(t,10).toFixed(0).replace(/./g,(c,u,s)=>u&&c!=="."&&(s.length-u)%3===0?`, ${c}`.replace(/\s/g,""):c)}`},openModal(){this.tempOrder={...this.selectedOrder},this.orderModal.show()},closeModal(){this.orderModal.hide()}},watch:{selectedOrder(){this.tempOrder={...this.selectedOrder}}},mounted(){this.orderModal=new v(this.$refs.modal)}},S={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},V={class:"modal-dialog modal-xl",role:"document"},E={class:"modal-content border-0"},U=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},I={class:"row"},B={class:"col-md-4"},N=e("h3",null,"用戶資料",-1),q={class:"table"},j={key:0},Z=e("th",{style:{width:"100px"}},"姓名",-1),z=e("th",null,"Email",-1),G=e("th",null,"電話",-1),H=e("th",null,"地址",-1),J=e("th",null,"備註",-1),K={class:"col-md-8"},Q=e("h3",null,"訂單細節",-1),R={class:"table"},T=e("th",{style:{width:"100px"}},"訂單編號",-1),W=e("th",null,"下單時間",-1),X=e("th",null,"付款時間",-1),Y={key:0},ee={key:1},te=e("th",null,"付款狀態",-1),se={key:0,class:"text-success"},le={key:1,class:"text-muted"},oe=e("th",null,"總金額",-1),de=e("h3",null,"選購商品",-1),ne={class:"table"},ae=e("thead",null,[e("tr")],-1),re={class:"text-end"},ie={class:"d-flex justify-content-end"},ce={class:"form-check"},he={class:"form-check-label",for:"flexCheckDefault"},ue={key:0},_e={key:1},pe={class:"modal-footer"},me=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function be(t,l,c,u,s,r){return d(),n("div",S,[e("div",V,[e("div",E,[U,e("div",F,[e("div",I,[e("div",B,[N,e("table",q,[s.tempOrder.user?(d(),n("tbody",j,[e("tr",null,[Z,e("td",null,o(s.tempOrder.user.name),1)]),e("tr",null,[z,e("td",null,o(s.tempOrder.user.email),1)]),e("tr",null,[G,e("td",null,o(s.tempOrder.user.tel),1)]),e("tr",null,[H,e("td",null,o(s.tempOrder.user.address),1)]),e("tr",null,[J,e("td",null,o(s.tempOrder.message),1)])])):y("",!0)])]),e("div",K,[Q,e("table",R,[e("tbody",null,[e("tr",null,[T,e("td",null,o(s.tempOrder.id),1)]),e("tr",null,[W,e("td",null,o(r.date(s.tempOrder.create_at)),1)]),e("tr",null,[X,e("td",null,[s.tempOrder.paid_date?(d(),n("span",Y,o(r.date(s.tempOrder.paid_date)),1)):(d(),n("span",ee,"時間不正確"))])]),e("tr",null,[te,e("td",null,[s.tempOrder.is_paid?(d(),n("strong",se,"已付款")):(d(),n("span",le,"尚未付款"))])]),e("tr",null,[oe,e("td",null,o(r.currency(s.tempOrder.total)),1)])])]),de,e("table",ne,[ae,e("tbody",null,[(d(!0),n(m,null,M(s.tempOrder.products,i=>(d(),n("tr",{key:i.id},[e("th",null,o(i.product.title),1),e("td",null,o(i.qty)+" / "+o(i.product.unit),1),e("td",re,o(r.currency(i.final_total)),1)]))),128))])]),e("div",ie,[e("div",ce,[f(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":l[0]||(l[0]=i=>s.tempOrder.is_paid=i)},null,512),[[k,s.tempOrder.is_paid]]),e("label",he,[s.tempOrder.is_paid?(d(),n("span",ue,"已付款")):(d(),n("span",_e,"未付款"))])])])])])]),e("div",pe,[me,e("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=i=>t.$emit("update-paid",s.tempOrder))}," 修改付款狀態 ")])])])],512)}const ge=O(P,[["render",be]]),fe={data(){return{myModal:""}},methods:{openModal(){this.myModal.show()},closeModal(){this.myModal.hide()}},mounted(){this.myModal=new v(this.$refs.modal)}},ye={class:"modal fade",id:"delAllModal","aria-hidden":"true",tabindex:"-1",ref:"modal"},Me={class:"modal-dialog"},Oe={class:"modal-content"},$e=e("div",{class:"modal-header bg-danger"},[e("h5",{class:"modal-title text-light"},"清空訂單"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ve=e("div",{class:"modal-body"},[e("p",null,"確定清空所有訂單？")],-1),ke={class:"modal-footer"},xe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function De(t,l,c,u,s,r){return d(),n("div",ye,[e("div",Me,[e("div",Oe,[$e,ve,e("div",ke,[xe,e("button",{type:"button",class:"btn btn-danger",onClick:l[0]||(l[0]=i=>this.$emit("clear-all"))},"確定刪除")])])])],512)}const Ce=O(fe,[["render",De]]),b="https://vue3-course-api.hexschool.io/v2",g="rock",Le={data(){return{orders:[],isLoading:!1,tempOrder:{},pagination:{}}},methods:{getOrders(){this.isLoading=!0,this.$http.get(`${b}/api/${g}/admin/orders`).then(t=>{this.orders=[...t.data.orders],this.pagination={...t.data.pagination},this.isLoading=!1}).catch(t=>{console.log(t.response.data.message),this.isLoading=!1})},date(t){return new Date(t*1e3).toLocaleDateString()},currency(t){return`${parseInt(t,10).toFixed(0).replace(/./g,(c,u,s)=>u&&c!=="."&&(s.length-u)%3===0?`, ${c}`.replace(/\s/g,""):c)}`},openDelOrderModal(t){this.tempOrder=t,this.$refs.deleteModal.openModal()},updatePaid(t){this.$http.put(`${b}/api/${g}/admin/order/${t.id}`,{data:t}).then(l=>{alert(l.data.message),this.$refs.orderModal.closeModal(),this.getOrders()}).catch(l=>{console.log(l),alert(l.response.data.message),this.$refs.orderModal.closeModal()})},deleteOrder(t){this.isLoading=!0,this.$http.delete(`${b}/api/${g}/admin/order/${t}`).then(l=>{this.isLoading=!1,alert(l.data.message+"該訂單"),this.$refs.deleteModal.hideModal(),this.getOrders()}).catch(l=>{this.isLoading=!1,alert(l.response.data.message),this.$refs.deleteModal.hideModal()})},openModal(t){this.tempOrder=t,this.$refs.orderModal.openModal()},deleteAllOrders(){this.isLoading=!0,this.$http.delete(`${b}/api/${g}/admin/orders/all`).then(t=>{alert(t.data.message),this.isLoading=!1,this.getOrders()}).catch(t=>{alert(t.response.data.message),this.isLoading=!1})}},mounted(){this.getOrders()},components:{DeleteModal:w,OrderModal:ge,DeleteAllModal:Ce,AdminPagination:A}},we=e("div",{class:"h3 text-center mt-4"},"訂單列表",-1),Ae={class:"container"},Pe={class:"text-end"},Se={class:"table mt-4"},Ve=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Ee={key:0},Ue=["textContent"],Fe={class:"list-unstyled"},Ie={class:"text-right"},Be={class:"form-check form-switch"},Ne=["id","onUpdate:modelValue","onChange"],qe=["for"],je={class:"btn-group"},Ze=["onClick"],ze=["onClick"];function Ge(t,l,c,u,s,r){const i=_("myLoading"),x=_("AdminPagination"),D=_("DeleteModal"),C=_("OrderModal"),L=_("DeleteAllModal");return d(),n(m,null,[p(i,{active:s.isLoading},null,8,["active"]),we,e("div",Ae,[e("div",Pe,[e("button",{type:"button",class:"btn btn-danger mt-3",onClick:l[0]||(l[0]=a=>this.$refs.deleteAllModal.openModal())},"刪除全部訂單")]),e("table",Se,[Ve,e("tbody",null,[(d(!0),n(m,null,M(s.orders,a=>(d(),n(m,{key:a.id},[s.orders.length?(d(),n("tr",Ee,[e("td",null,o(r.date(a.create_at)),1),e("td",null,[a.user?(d(),n("span",{key:0,textContent:o(a.user.email)},null,8,Ue)):y("",!0)]),e("td",null,[e("ul",Fe,[(d(!0),n(m,null,M(a.products,h=>(d(),n("li",{key:h.id},o(h.product.title)+" 數量："+o(h.qty)+" "+o(h.product.unit),1))),128))])]),e("td",Ie,o(r.currency(a.total)),1),e("td",null,[e("div",Be,[f(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":h=>a.is_paid=h,onChange:h=>r.updatePaid(a)},null,40,Ne),[[k,a.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[f(e("span",null,"已付款",512),[[$,a.is_paid]]),f(e("span",null,"未付款",512),[[$,!a.is_paid]])],8,qe)])]),e("td",null,[e("div",je,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:h=>r.openModal(a)}," 檢視 ",8,Ze),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:h=>r.openDelOrderModal(a)}," 刪除 ",8,ze)])])])):y("",!0)],64))),128))])]),p(x,{pages:s.pagination,onEmitPage:r.getOrders,ref:"pagination"},null,8,["pages","onEmitPage"])]),p(D,{product:s.tempOrder,onDeleteItem:r.deleteOrder,ref:"deleteModal"},null,8,["product","onDeleteItem"]),p(C,{selectedOrder:s.tempOrder,onUpdatePaid:r.updatePaid,ref:"orderModal"},null,8,["selectedOrder","onUpdatePaid"]),p(L,{ref:"deleteAllModal",onClearAll:r.deleteAllOrders},null,8,["onClearAll"])],64)}const Qe=O(Le,[["render",Ge]]);export{Qe as default};
