import{_ as L,s as P,r as k,d as M,o as b,c as p,a as t,t as B,w as N,v as $,F as q,p as j,b as z,u as E,i as C,f as _,g as F,k as A,l as D,j as H,m as O,H as S}from"./index-M6RErX2x.js";import{F as R}from"./FlowChart-SMLjFwRa.js";import{u as Q}from"./cart-IGDU7hZ1.js";import{n as d,a as G}from"./axios-LTYA-9z7.js";import{S as U}from"./sweetalert2.all-kX3ik7BC.js";import{d as I}from"./math-9XHDQUjD.js";const J={props:["cart"],setup(s){const a=Q(),{getCart:c,deleteCart:e,updateCart:w,changeAddStatus:l}=a,{addBtnState:h}=P(a),n=k(s.cart.qty),u=k(null);let x=0;const v=k(!1),y=async()=>{l(!0),U.fire({icon:"warning",title:`確定刪除${s.cart.product.title}`,text:"刪除後的資料無法恢復",showCancelButton:!0,confirmButtonColor:"red",cancelButtonColor:"gray",confirmButtonText:"確定",cancelButtonText:"取消"}).then(async f=>{f.isConfirmed?(await e(s.cart.id).then(i=>{d(!0,`${s.cart.product.title}${i.data.message}`)}).catch(i=>{d(!1,`${i.response.data.message}`)}),await c()):f.isDenied&&d(!1,"動作取消")}),l(!1)},V=async()=>{l(!0),n.value+=1;const f={data:{product_id:s.cart.product_id,qty:n.value}};await w(s.cart.id,f).then(i=>{d(!0,`${s.cart.product.title}已加入`)}).catch(i=>{d(!1,`${i.response.data.message}`)}),await c(),l(!1)},o=async()=>{l(!0);const f={data:{product_id:s.cart.product_id,qty:n.value}};await w(s.cart.id,f).then(i=>{d(!0,`${s.cart.product.title}已更新`)}).catch(i=>{d(!1,`${i.response.data.message}`)}),await c(),l(!1)},r=async()=>{if(l(!0),n.value-=1,n.value<1){d(!1,"數量不得小於1"),n.value=1,l(!1);return}const f={data:{product_id:s.cart.product_id,qty:n.value}};await w(s.cart.id,f).then(i=>{d(!0,`${s.cart.product.title}已移除`)}).catch(i=>{d(!1,`${i.response.data.message}`)}),await c(),l(!1)};return M(()=>{l(!1),u.value.addEventListener("focus",()=>{x=n.value}),u.value.addEventListener("blur",()=>{n.value<1?(d(!1,"數量不得小於1"),n.value=1):x!==n.value&&o()})}),{qty:n,myQty:u,addQty:V,delFloat:I,minusQty:r,updateQty:o,deleteItem:y,isRenewing:v,addBtnState:h,changeAddStatus:l}}},T=s=>(j("data-v-5d558835"),s=s(),z(),s),K={class:"row"},W={class:"col-md-4"},X=["src"],Y={class:"col-md-8 d-flex justify-content-between align-items-center my-3 my-lg-0"},Z={class:"d-flex justify-content-between flex-lg-column"},tt={class:"mt-3"},et={class:"mt-3 mt-lg-0"},at={key:0,class:"mt-lg-0 text-success"},st={key:1,class:"mt-lg-0"},ot={class:"d-flex"},lt={class:"input-group mb-3",style:{"max-width":"150px","max-height":"20px"}},nt=["disabled"],dt=T(()=>t("i",{class:"bi bi-dash-lg"},null,-1)),ct=[dt],it=["disabled"],rt=T(()=>t("i",{class:"bi bi-plus-lg"},null,-1)),mt=[rt],ut={class:"ms-3 d-flex flex-column justify-content-center"},_t=["disabled"],ft=T(()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"currentColor",class:"bi bi-trash mt-2",viewBox:"0 0 16 16"},[t("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),t("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})],-1)),ht=[ft],bt=T(()=>t("hr",null,null,-1));function vt(s,a,c,e,w,l){return b(),p(q,null,[t("div",K,[t("div",W,[t("img",{src:c.cart.product.imageUrl,alt:"",class:"img-fluid object-fit-cover"},null,8,X)]),t("div",Y,[t("div",Z,[t("div",tt,[t("h5",null,B(c.cart.product.title),1),t("p",et,"單價：NT$ "+B(c.cart.product.price),1),c.cart.final_total!==c.cart.total?(b(),p("p",at,"折扣價：NT$ "+B(e.delFloat(c.cart.final_total)),1)):(b(),p("p",st,"小計：NT$ "+B(c.cart.total),1))])]),t("div",ot,[t("div",lt,[t("button",{disabled:e.addBtnState,class:"fs-4 btn btn-sm btn-secondary border-0",type:"button",onClick:a[0]||(a[0]=h=>e.minusQty())},ct,8,nt),N(t("input",{"onUpdate:modelValue":a[1]||(a[1]=h=>e.qty=h),type:"number",class:"form-control text-center rounded",placeholder:"1",min:"1",ref:"myQty"},null,512),[[$,e.qty]]),t("button",{disabled:e.addBtnState,class:"fs-4 btn btn-sm btn-secondary border-0",type:"button",onClick:a[2]||(a[2]=h=>e.addQty())},mt,8,it)]),t("div",ut,[t("button",{type:"button",class:"bg-white border-0",onClick:a[3]||(a[3]=h=>e.deleteItem()),disabled:e.addBtnState},ht,8,_t)])])])]),bt],64)}const yt=L(J,[["render",vt],["__scopeId","data-v-5d558835"]]),gt={components:{FlowChart:R,ProductOrderCard:yt},setup(s){const a=Q(),{cart:c,addBtnState:e,isCartLoading:w}=P(a),{getCart:l,deleteAllCart:h,useCoupon:n,changeAddStatus:u}=a,x=async()=>{u(!0);const g={data:{code:V.value}};await n(g).then(m=>{d(!0,m.data.message),l()}).catch(m=>{d(!1,m.response.data.message)}),u(!1)},v=async()=>{U.fire({icon:"warning",title:"確定刪除整個購物車？",text:"刪除後的資料無法恢復",showCancelButton:!0,confirmButtonColor:"red",cancelButtonColor:"gray",confirmButtonText:"確定",cancelButtonText:"取消"}).then(async g=>{g.isConfirmed?(u(!0),await h().then(m=>{d(!0,`全部${m.data.message}`)}).catch(m=>{console.log(m.response.data.message),d(!1,`${m.response.data.message}`)}),await l(),u(!1)):g.isDenied&&d(!1,"動作取消")})},y=E(),V=k(null),o=k(""),r=()=>{const g={data:{user:f.value,message:o.value}};G.sendOrder(g).then(async m=>{await l(),y.push(`/payment?id=${m.data.orderId}`)}).catch(m=>{console.log(m)})},f=k({email:"",name:"",address:"",tel:""}),i=g=>/^(09)[0-9]{8}$/.test(g)?!0:"需要正確的電話號碼";return M(()=>{u(!1)}),{cart:c,isCartLoading:w,addBtnState:e,changeAddStatus:u,cartStore:a,message:o,couponCode:V,isPhone:i,user:f,goToPayment:r,clearCart:v,useMyCoupon:x,delFloat:I}}},pt={class:"container my-4"},wt={class:"my-5 row justify-content-center"},Ct={class:"col-lg-6"},xt=t("h4",{class:"text-center"},"購物車資訊",-1),Vt={class:"mt-3 text-end"},Bt=["disabled"],kt=t("hr",null,null,-1),St={key:0,class:"text-center my-5"},Tt=t("p",{class:"fs-4 fw-bold"},"你的購物車現在沒東西喔!",-1),Nt={class:"row"},$t={class:"col-md-6 my-3"},qt={class:"input-group my-auto"},Ft=["disabled"],Lt={class:"col-md-6 my-3 d-flex flex-row-reverse align-items-center"},Pt={key:0,class:"fs-4 fw-bold text-success"},Mt={key:1,class:"fs-4 fw-bold"},Qt={class:"col-lg-6"},Ut=t("h4",{class:"text-center"},"訂購人資訊",-1),It=t("hr",null,null,-1),jt={class:"mb-3"},zt=t("label",{for:"email",class:"form-label"},"Email",-1),Et={class:"mb-3"},At=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Dt={class:"mb-3"},Ht=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),Ot={class:"mb-3"},Rt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Gt={class:"mb-3"},Jt=t("label",{for:"message",class:"form-label"},"留言",-1),Kt={class:"text-end"},Wt=["disabled"];function Xt(s,a,c,e,w,l){const h=C("myLoading"),n=C("FlowChart"),u=C("router-link"),x=C("ProductOrderCard"),v=C("v-field"),y=C("error-message"),V=C("v-form");return b(),p(q,null,[_(h,{active:e.isCartLoading},null,8,["active"]),_(n,{outProgress:0}),t("div",pt,[t("div",wt,[t("div",Ct,[xt,t("div",Vt,[t("button",{type:"button",class:"btn btn-outline-success",onClick:a[0]||(a[0]=o=>e.clearCart()),disabled:e.addBtnState||!e.cart.total},"清空購物車",8,Bt)]),kt,e.cart.total?A("",!0):(b(),p("div",St,[Tt,_(u,{to:"/products",class:"btn btn-lg btn-success"},{default:F(()=>[H("選購商品")]),_:1})])),(b(!0),p(q,null,D(e.cart.carts,o=>(b(),O(x,{key:o.id,cart:o},null,8,["cart"]))),128)),t("div",Nt,[t("div",$t,[t("div",qt,[N(t("input",{type:"text",class:"form-control",placeholder:"請輸入折扣碼","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":a[1]||(a[1]=o=>e.couponCode=o)},null,512),[[$,e.couponCode]]),t("button",{disabled:e.addBtnState||!e.cart.total,class:"btn btn-outline-success",type:"button",id:"button-addon2",onClick:a[2]||(a[2]=o=>e.useMyCoupon())}," 套用 ",8,Ft)])]),t("div",Lt,[e.cart.final_total!==e.cart.total?(b(),p("span",Pt,"折扣價：NT$ "+B(e.delFloat(e.cart.final_total)),1)):(b(),p("span",Mt,"總計：NT$ "+B(e.cart.total),1))])])]),t("div",Qt,[Ut,It,_(V,{onSubmit:a[8]||(a[8]=o=>e.goToPayment()),class:"bg-light p-3 rounded",ref:"form"},{default:F(({errors:o})=>[t("div",jt,[zt,_(v,{id:"email",name:"email",type:"email",class:S(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:e.user.email,"onUpdate:modelValue":a[3]||(a[3]=r=>e.user.email=r)},null,8,["class","modelValue"]),_(y,{name:"email",class:"invalid-feedback"})]),t("div",Et,[At,_(v,{id:"name",name:"姓名",type:"text",class:S(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:e.user.name,"onUpdate:modelValue":a[4]||(a[4]=r=>e.user.name=r)},null,8,["class","modelValue"]),_(y,{name:"姓名",class:"invalid-feedback"})]),t("div",Dt,[Ht,_(v,{id:"tel",name:"電話",type:"text",class:S(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",rules:e.isPhone,modelValue:e.user.tel,"onUpdate:modelValue":a[5]||(a[5]=r=>e.user.tel=r)},null,8,["class","rules","modelValue"]),_(y,{name:"電話",class:"invalid-feedback"})]),t("div",Ot,[Rt,_(v,{id:"address",name:"地址",type:"text",class:S(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:e.user.address,"onUpdate:modelValue":a[6]||(a[6]=r=>e.user.address=r)},null,8,["class","modelValue"]),_(y,{name:"地址",class:"invalid-feedback"})]),t("div",Gt,[Jt,N(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":a[7]||(a[7]=r=>e.message=r)},null,512),[[$,e.message]])]),t("div",Kt,[t("button",{type:"submit",class:"btn btn-success",disabled:e.addBtnState||!e.cart.total}," 送出訂單 ",8,Wt)])]),_:1},512)])])])],64)}const oe=L(gt,[["render",Xt]]);export{oe as default};
