import{_ as U,M as L,o as h,c as b,a as e,w as _,h as N,v as C,Z as S,r as u,d as P,i as M,f as g,F as $,l as E,Y as y,t as w}from"./index-knGgcmAB.js";import{D as I}from"./DeleteModal-FEb08kT9.js";import{A as T}from"./BottomPagination-66uXzUlg.js";const B={data(){return{couponModal:"",tempCoupon:{},due_date:"",is_newCoupon:!1}},props:["coupon","isNew"],methods:{openModal(){this.couponModal.show()},closeModal(){this.couponModal.hide()},updateCoupon(){this.$emit("update",this.tempCoupon)}},mounted(){this.couponModal=new L(this.$refs.modal,{keyboard:!1})},watch:{coupon(){this.tempCoupon={...this.coupon},this.tempCoupon.due_date=this.tempCoupon.due_date*1e3;const v=new Date(this.tempCoupon.due_date).toISOString().split("T");this.due_date=v[0]},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date))},isNew(){this.is_newCoupon=this.isNew}}},F={id:"couponModal",ref:"modal",class:"modal fade",tabindex:"1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},O={class:"modal-dialog",role:"document"},Y={class:"modal-content"},Z={class:"modal-header bg-secondary"},j={class:"modal-title text-white"},q=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},G={class:"mb-3"},H=e("label",{for:"title"},"標題",-1),J={class:"mb-3"},K=e("label",{for:"coupon_code"},"優惠碼",-1),Q={class:"mb-3"},R=e("label",{for:"due_date"},"到期日",-1),W={class:"mb-3"},X=e("label",{for:"price"},"折扣百分比",-1),ee={class:"mb-3"},oe={class:"form-check"},te=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ne={class:"modal-footer"},se=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function le(v,o,m,t,l,c){return h(),b("div",F,[e("div",O,[e("div",Y,[e("div",Z,[e("h5",j,[_(e("span",null,"新增優惠券",512),[[N,m.isNew]]),_(e("span",null,"更新優惠券",512),[[N,!m.isNew]])]),q]),e("div",z,[e("div",G,[H,_(e("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=n=>l.tempCoupon.title=n)},null,512),[[C,l.tempCoupon.title]])]),e("div",J,[K,_(e("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[1]||(o[1]=n=>l.tempCoupon.code=n)},null,512),[[C,l.tempCoupon.code]])]),e("div",Q,[R,_(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=n=>l.due_date=n)},null,512),[[C,l.due_date]])]),e("div",W,[X,_(e("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入折扣百分比","onUpdate:modelValue":o[3]||(o[3]=n=>l.tempCoupon.percent=n)},null,512),[[C,l.tempCoupon.percent,void 0,{number:!0}]])]),e("div",ee,[e("div",oe,[_(e("input",{type:"checkbox",class:"form-check-input","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=n=>l.tempCoupon.is_enabled=n)},null,512),[[S,l.tempCoupon.is_enabled]]),te])])]),e("div",ne,[se,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=n=>c.updateCoupon())},"更新優惠券")])])])],512)}const ae=U(B,[["render",le]]),k="https://vue3-course-api.hexschool.io/v2",x="rock",de={components:{CouponModal:ae,AdminPagination:T,DeleteModal:I},setup(v){const o=u([]),m=u({}),t=u({}),l=u(!1),c=u(!1),n=u(null),p=u(null),f=u({title:"",is_enabled:0,code:"",due_date:new Date/1e3,percent:"",id:""}),D=(s,d={})=>{s==="new"?(c.value=!0,t.value={...f.value},n.value.openModal()):s==="delete"?(c.value=!1,t.value=d,p.value.openModal()):s==="edit"&&(c.value=!1,t.value={...d},n.value.openModal())},a=()=>{n.value.closeModal(),p.value.hideModal()},r=()=>{l.value=!0,y.get(`${k}/api/${x}/admin/coupons`).then(s=>{o.value=[...s.data.coupons],m.value={...s.data.pagination},o.value.forEach(d=>{const i=new Date(d.due_date*1e3).toISOString().split("T")[0];d.formatDate=i}),l.value=!1}).catch(s=>{alert(s.message),l.value=!1})},V=s=>{y.delete(`${k}/api/${x}/admin/coupon/${s}`).then(d=>{alert(d.data.message),p.value.hideModal(),r()}).catch(d=>{alert(d.message),p.value.hideModal()})},A=s=>{const d={title:s.title,is_enabled:s.is_enabled,percent:s.percent,due_date:s.due_date/1e3,code:s.code};c.value?y.post(`${k}/api/${x}/admin/coupon`,{data:d}).then(i=>{alert(i.data.message),a(),r()}).catch(i=>{console.log(i),alert(i.response.data.message)}):y.put(`${k}/api/${x}/admin/coupon/${s.id}`,{data:d}).then(i=>{alert(i.data.message),a(),r()}).catch(i=>{alert(i.response.data.message)})};return P(()=>{r()}),{coupons:o,pages:m,tempCoupon:t,isLoading:l,isNew:c,emptyCoupon:f,openModal:D,couponModal:n,delCouponModal:p,closeModal:a,getCoupons:r,deleteCoupon:V,updateCoupon:A}}},ie=e("div",{class:"h3 mt-4 text-center"},"優惠卷新增頁面",-1),ce={class:"container"},ue={class:"text-end mt-4"},pe={class:"table mt-4"},re=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"折扣碼"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),_e={key:0,class:"text-success"},me={key:1},he={class:"btn-group"},be=["onClick"],ve=["onClick"];function fe(v,o,m,t,l,c){const n=M("myLoading"),p=M("CouponModal"),f=M("DeleteModal"),D=M("AdminPagination");return h(),b($,null,[g(n,{active:t.isLoading},null,8,["active"]),ie,e("div",ce,[e("div",ue,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=a=>t.openModal("new"))}," 建立新的優惠卷 "),g(p,{ref:"couponModal",onUpdate:t.updateCoupon,isNew:t.isNew,coupon:t.tempCoupon},null,8,["onUpdate","isNew","coupon"])]),e("table",pe,[re,e("tbody",null,[(h(!0),b($,null,E(t.coupons,a=>(h(),b("tr",{key:a.id},[e("td",null,w(a.title),1),e("td",null,w(a.percent),1),e("td",null,w(a.formatDate),1),e("td",null,w(a.code),1),e("td",null,[a.is_enabled?(h(),b("span",_e,"啟用")):(h(),b("span",me,"未啟用"))]),e("td",null,[e("div",he,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:r=>t.openModal("edit",a)}," 編輯 ",8,be),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>t.openModal("delete",a)}," 刪除 ",8,ve)])])]))),128))])]),g(f,{product:t.tempCoupon,onDeleteItem:t.deleteCoupon,ref:"delCouponModal"},null,8,["product","onDeleteItem"]),g(D,{pages:t.pages,onEmitPage:t.getCoupons,ref:"pagination"},null,8,["pages","onEmitPage"])])],64)}const ye=U(de,[["render",fe]]);export{ye as default};
