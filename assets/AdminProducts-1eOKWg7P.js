import{_ as B,r as u,y as $,d as A,M as G,i as P,o as l,c as a,a as t,w as h,v as f,F as k,l as D,$ as S,E as q,f as y,Z as U,t as M}from"./index-7sQXWFie.js";import{D as Z}from"./DeleteModal-CRaiYMzW.js";import{B as j}from"./BottomPagination-6omV3C6J.js";const C="https://vue3-course-api.hexschool.io/v2",V="rock",z={props:["isNew","tempProduct","currentPage"],emits:["getProducts"],setup(v,e){let b;const o=u(null),g=u(null),i=u({}),m=u(!1),s=u(null),n=()=>{v.isNew?U.post(`${C}/api/${V}/admin/product`,{data:i.value}).then(p=>{alert(p.data.message),i.value={},w(),r()}).catch(p=>{alert(p.response.data.message)}):U.put(`${C}/api/${V}/admin/product/${v.tempProduct.id}`,{data:i.value}).then(p=>{alert(p.data.message),i.value={},w(),r()}).catch(p=>{alert(p.response.data.message)})},_=()=>{i.value.imagesUrl=[],i.value.imagesUrl.push("")},w=()=>{e.emit("getProducts",v.currentPage)},c=()=>{i.value=v.tempProduct,b.show()},r=()=>{b.hide()},d=()=>{const p=o.value.files[0],F=new FormData;F.append("file-to-upload",p),U.post(`${C}/api/${V}/admin/upload`,F).then(x=>{i.value.imageUrl=x.data.imageUrl}).catch(x=>{alert(x.response.data.message)})},T=p=>{const x=document.querySelectorAll(".uploadImages")[p].files[0],I=new FormData;I.append("file-to-upload",x),U.post(`${C}/api/${V}/admin/upload`,I).then(N=>{i.value.imagesUrl[p]=N.data.imageUrl}).catch(N=>{alert(N.response.data.message)})};return $(()=>v.isNew,()=>{m.value=v.isNew}),A(()=>{b=new G(s.value,{keyboard:!1}),o.value=g.value,o.value.addEventListener("change",d)}),{product:i,myNew:m,updateProduct:n,createImages:_,openModal:c,hideModal:r,uploadFile:d,uploadFiles:T,modal:s,formFile:g,fileInput:o}}},H={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},J={class:"modal-dialog modal-xl"},K={class:"modal-content border-0"},O={class:"modal-header bg-secondary text-white"},Q={id:"productModalLabel",class:"modal-title"},R={key:0},W={key:1},X=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},tt={class:"row"},ot={class:"col-sm-4"},et={class:"mb-2"},st={class:"mb-3"},lt=t("h3",{class:"mb-3"},"主要圖片",-1),at=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),nt={class:"mb-3"},dt=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),it=["src"],rt=t("h3",{class:"mb-3"},"多圖新增",-1),ct={key:0},ut={class:"mb-3"},mt=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),pt=["onUpdate:modelValue"],_t={class:"mb-3"},ht=t("label",{for:"formFile",class:"form-label"},"上傳檔案",-1),bt=["onChange"],ft=["src"],vt={key:0},gt={key:1},yt={key:1},wt={class:"col-sm-8"},Pt={class:"mb-3"},Ut=t("label",{for:"title",class:"form-label"},"標題",-1),kt={class:"row"},xt={class:"mb-3 col-md-6"},Mt=t("label",{for:"category",class:"form-label"},"分類",-1),Ct={class:"mb-3 col-md-6"},Vt=t("label",{for:"price",class:"form-label"},"單位",-1),Dt={class:"row"},Ft={class:"mb-3 col-md-6"},Nt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),It={class:"mb-3 col-md-6"},Et=t("label",{for:"price",class:"form-label"},"售價",-1),Lt=t("hr",null,null,-1),Bt={class:"mb-3"},At=t("label",{for:"description",class:"form-label"},"產品描述",-1),Tt={class:"mb-3"},$t=t("label",{for:"content",class:"form-label"},"說明內容",-1),Gt={class:"mb-3"},St=t("label",{for:"presever",class:"form-label"},"保存方式",-1),qt={class:"mb-3 row"},Zt={class:"mb-3 col-md-6"},jt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),zt={class:"mb-3 col-md-6 row"},Ht=t("label",{for:"price",class:"col-sm-3 col-form-label"},"推薦度",-1),Jt={class:"col-sm-5 mt-1"},Kt=["onClick"],Ot={key:0},Qt={key:1},Rt={class:"modal-footer"};function Wt(v,e,b,o,g,i){const m=P("font-awesome-icon");return l(),a("div",H,[t("div",J,[t("div",K,[t("div",O,[t("h5",Q,[b.isNew?(l(),a("span",R,"新增產品")):(l(),a("span",W,"編輯產品"))]),X]),t("div",Y,[t("div",tt,[t("div",ot,[t("div",et,[t("div",st,[lt,at,h(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>o.product.imageUrl=s)},null,512),[[f,o.product.imageUrl]])]),t("div",nt,[dt,t("input",{class:"form-control",type:"file",id:"formFile",ref:"formFile",onChange:e[1]||(e[1]=s=>o.uploadFile())},null,544)]),t("img",{class:"img-fluid",src:o.product.imageUrl},null,8,it)]),rt,Array.isArray(o.product.imagesUrl)?(l(),a("div",ct,[(l(!0),a(k,null,D(o.product.imagesUrl,(s,n)=>(l(),a(k,{key:n},[t("div",ut,[mt,h(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":_=>o.product.imagesUrl[n]=_},null,8,pt),[[f,o.product.imagesUrl[n]]])]),t("div",_t,[ht,t("input",{class:"form-control uploadImages",type:"file",onChange:_=>o.uploadFiles(n)},null,40,bt),t("img",{class:"img-fluid",src:o.product.imagesUrl[n]},null,8,ft)])],64))),128)),!o.product.imagesUrl.length||o.product.imagesUrl[o.product.imagesUrl.length-1]?(l(),a("div",vt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=s=>o.product.imagesUrl.push(""))}," 新增圖片 ")])):(l(),a("div",gt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=s=>o.product.imagesUrl.pop())}," 刪除圖片 ")]))])):(l(),a("div",yt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=s=>o.createImages())}," 新增圖片 ")]))]),t("div",wt,[t("div",Pt,[Ut,h(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=s=>o.product.title=s)},null,512),[[f,o.product.title]])]),t("div",kt,[t("div",xt,[Mt,h(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=s=>o.product.category=s)},null,512),[[f,o.product.category]])]),t("div",Ct,[Vt,h(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=s=>o.product.unit=s)},null,512),[[f,o.product.unit]])])]),t("div",Dt,[t("div",Ft,[Nt,h(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=s=>o.product.origin_price=s)},null,512),[[f,o.product.origin_price,void 0,{number:!0}]])]),t("div",It,[Et,h(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=s=>o.product.price=s)},null,512),[[f,o.product.price,void 0,{number:!0}]])])]),Lt,t("div",Bt,[At,h(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=s=>o.product.description=s)},`\r
                `,512),[[f,o.product.description]])]),t("div",Tt,[$t,h(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=s=>o.product.content=s)},`\r
                `,512),[[f,o.product.content]])]),t("div",Gt,[St,h(t("textarea",{name:"presever",type:"text",id:"presever",class:"form-control",placeholder:"請輸入保存方式","onUpdate:modelValue":e[12]||(e[12]=s=>o.product.presever=s)},`\r
                `,512),[[f,o.product.presever]])]),t("div",qt,[t("div",Zt,[h(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[13]||(e[13]=s=>o.product.is_enabled=s)},null,512),[[S,o.product.is_enabled]]),jt]),t("div",zt,[Ht,t("div",Jt,[(l(),a(k,null,D(5,(s,n)=>t("a",{href:"#",key:n,onClick:q(_=>o.product.stars=n+1,["prevent"])},[n+1<=b.tempProduct.stars?(l(),a("span",Ot,[y(m,{icon:["fas","star"]})])):(l(),a("span",Qt,[y(m,{icon:["far","star"]})]))],8,Kt)),64))])])])])])]),t("div",Rt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[14]||(e[14]=s=>o.hideModal())}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[15]||(e[15]=s=>o.updateProduct())}," 確認 ")])])])],512)}const Xt=B(z,[["render",Wt]]),E="https://vue3-course-api.hexschool.io/v2",L="rock",Yt={components:{EditProduct:Xt,DeleteProduct:Z,BottomPagination:j},setup(v){const e=u({imagesUrl:[]}),b=u([]),o=u(!0),g=u({}),i=u(null),m=u(null),s=u(!1),n=u(1),_=(r=1)=>{s.value=!0,U.get(`${E}/api/${L}/admin/products?page=${r}`).then(d=>{b.value=d.data.products,g.value=d.data.pagination,n.value=r,s.value=!1}).catch(d=>{console.dir(d),s.value=!1})},w=(r,d={})=>{r==="new"?(e.value={imagesUrl:[]},o.value=!0,setTimeout(()=>{i.value.openModal()},500)):r==="edit"?(e.value={...d},e.value.imagesUrl||(e.value.imagesUrl=[]),o.value=!1,setTimeout(()=>{i.value.openModal()},500)):r==="delete"&&(e.value=d,setTimeout(()=>{m.value.openModal()},500))},c=r=>{U.delete(`${E}/api/${L}/admin/product/${r}`).then(d=>{alert(d.data.message),m.value.hideModal(),_(n.value)}).catch(d=>{alert(d.response.data.message),m.value.hideModal()})};return A(()=>{_()}),{products:b,isNew:o,pages:g,tempProduct:e,productModal:i,delProductModal:m,isLoading:s,currentPage:n,getProducts:_,openModal:w,deleteProduct:c}}},to=t("div",{class:"h3 text-center mt-4"},"後台產品列表",-1),oo={class:"container"},eo={class:"text-end mt-4"},so={class:"table mt-4"},lo=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"150"},"商品推薦"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),ao={key:0},no={key:1},io=t("i",{class:"far fa-star"},null,-1),ro=[io],co={class:"text-end"},uo={class:"text-end"},mo={key:0,class:"text-success"},po={key:1},_o={class:"btn-group"},ho=["onClick"],bo=["onClick"];function fo(v,e,b,o,g,i){const m=P("myLoading"),s=P("font-awesome-icon"),n=P("EditProduct"),_=P("DeleteProduct"),w=P("BottomPagination");return l(),a(k,null,[y(m,{active:o.isLoading},null,8,["active"]),to,t("div",oo,[t("div",eo,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=c=>o.openModal("new"))}," 建立新的產品 ")]),t("table",so,[lo,t("tbody",null,[(l(!0),a(k,null,D(o.products,c=>(l(),a("tr",{key:c.id},[t("td",null,M(c.category),1),t("td",null,M(c.title),1),t("td",null,[(l(),a(k,null,D(5,(r,d)=>t("span",{key:d},[d+1<=c.stars?(l(),a("span",ao,[y(s,{icon:"fas fa-star"})])):(l(),a("span",no,ro))])),64))]),t("td",co,M(c.origin_price),1),t("td",uo,M(c.price),1),t("td",null,[c.is_enabled?(l(),a("span",mo,"啟用")):(l(),a("span",po,"未啟用"))]),t("td",null,[t("div",_o,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:r=>o.openModal("edit",c)}," 編輯 ",8,ho),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>o.openModal("delete",c)}," 刪除 ",8,bo)])])]))),128))])]),y(n,{"is-new":o.isNew,"temp-product":o.tempProduct,"current-page":o.currentPage,onGetProducts:o.getProducts,ref:"productModal"},null,8,["is-new","temp-product","current-page","onGetProducts"]),y(_,{product:o.tempProduct,onDeleteItem:o.deleteProduct,ref:"delProductModal"},null,8,["product","onDeleteItem"]),y(w,{pages:o.pages,onEmitPage:o.getProducts,ref:"pagination"},null,8,["pages","onEmitPage"])])],64)}const wo=B(Yt,[["render",fo]]);export{wo as default};
